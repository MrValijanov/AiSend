<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <title>AiSend · Super Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #021608;
      --card: #05250f;
      --accent: #1dd24a;
      --accent-soft: #b5ff6f;
      --accent-dark: #0b752a;
      --text-main: #ffffff;
      --text-muted: #a7bfa7;
      --danger: #ff5b5b;
      --border-soft: rgba(255, 255, 255, 0.05);
      --radius-xl: 22px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Roboto", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #063517 0, #021608 55%, #010705 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    .app {
      min-height: 100vh;
      padding: 16px 14px 24px;
      max-width: 480px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .logo-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-badge {
      width: 42px;
      height: 42px;
      border-radius: 18px;
      background: radial-gradient(circle at 30% 20%, #9fff7a 0, #0fb741 40%, #021608 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 22px;
      color: #021608;
      box-shadow: 0 0 24px rgba(43, 255, 117, 0.35);
    }

    .app-name {
      font-size: 24px;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .app-sub {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .profile-btn {
      padding: 8px 16px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.2), rgba(20, 50, 30, 0.9));
      color: var(--text-main);
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .profile-btn span {
      font-size: 10px;
      opacity: 0.8;
    }

    .chip-row {
      display: flex;
      gap: 8px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }

    .chip {
      font-size: 11px;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: var(--text-muted);
      background: rgba(0, 0, 0, 0.25);
    }

    .chip.primary {
      border-color: #22c55e;
      color: #bbf7d0;
      background: rgba(21, 128, 61, 0.3);
    }

    .card {
      background: radial-gradient(circle at top left, #06351a 0, #021608 45%, #010705 100%);
      border-radius: 26px;
      padding: 18px 18px 18px;
      border: 1px solid var(--border-soft);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.6);
      margin-bottom: 16px;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 20px;
      font-weight: 700;
    }

    .card-sub {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .total-amount {
      font-size: 26px;
      font-weight: 700;
      margin-top: 6px;
    }

    .total-sub {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .link-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      font-size: 13px;
      color: var(--accent-soft);
    }

    .link-row button {
      padding: 6px 10px;
      font-size: 12px;
      border-radius: 999px;
      border: 1px solid rgba(190, 242, 100, 0.5);
      background: rgba(21, 128, 61, 0.3);
      color: #ecfccb;
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 8px;
    }

    .menu-item {
      border-radius: 20px;
      padding: 14px 14px 12px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.85);
      display: flex;
      flex-direction: column;
      gap: 4px;
      cursor: pointer;
    }

    .menu-item.main {
      grid-column: span 2;
      background: radial-gradient(circle at 10% 0%, #22c55e 0, #064e3b 40%, #020617 100%);
      border-color: rgba(74, 222, 128, 0.7);
      box-shadow: 0 16px 32px rgba(22, 163, 74, 0.55);
    }

    .menu-title {
      font-size: 15px;
      font-weight: 600;
    }

    .menu-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    .menu-item.main .menu-sub {
      color: #bbf7d0;
    }

    .footer-note {
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
      margin-top: 10px;
      line-height: 1.4;
    }

    /* ==== MODAL / SHEET BAZA ==== */

    .sheet-bg {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.72);
      backdrop-filter: blur(10px);
      display: none;
      align-items: flex-end;
      justify-content: center;
      z-index: 40;
    }

    .sheet-bg.active {
      display: flex;
    }

    .sheet {
      width: 100%;
      max-width: 480px;
      border-radius: 24px 24px 0 0;
      padding: 18px 18px 22px;
      background: radial-gradient(circle at top, #022c1f 0, #010b07 55%, #000 100%);
      border-top: 1px solid rgba(74, 222, 128, 0.45);
      box-shadow: 0 -12px 40px rgba(0, 0, 0, 0.7);
      max-height: 82vh;
      overflow-y: auto;
    }

    .sheet-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .sheet-title {
      font-size: 18px;
      font-weight: 600;
    }

    .sheet-close {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
    }

    .section-label {
      font-size: 11px;
      letter-spacing: 0.18em;
      color: rgba(148, 163, 184, 0.9);
      text-transform: uppercase;
      margin: 10px 2px 4px;
    }

    .field {
      margin-bottom: 12px;
    }

    label {
      display: block;
      font-size: 13px;
      margin-bottom: 6px;
    }

    select,
    input[type="text"],
    input[type="number"] {
      width: 100%;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      background: rgba(0, 0, 0, 0.35);
      color: var(--text-main);
      padding: 11px 12px;
      font-size: 14px;
      outline: none;
    }

    select:focus,
    input:focus {
      border-color: rgba(74, 222, 128, 0.8);
      box-shadow: 0 0 0 1px rgba(74, 222, 128, 0.2);
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 14px 18px;
      font-size: 16px;
      font-weight: 600;
      width: 100%;
      text-align: center;
      cursor: pointer;
      color: #022c15;
      background: linear-gradient(90deg, #bef264, #4ade80);
      box-shadow: 0 14px 30px rgba(22, 163, 74, 0.55);
      margin-top: 6px;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 8px 20px rgba(22, 163, 74, 0.4);
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
      box-shadow: none;
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      font-size: 14px;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .badge {
      font-size: 11px;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: #e5e7eb;
      background: rgba(15, 23, 42, 0.8);
    }

    .asset-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin: 4px 0;
      font-size: 13px;
    }

    .asset-row strong {
      font-size: 14px;
    }

    .muted {
      color: var(--text-muted);
      font-size: 12px;
    }

    .send-status {
      margin-top: 8px;
      font-size: 12px;
      color: #bbf7d0;
    }

    .send-status.err {
      color: var(--danger);
    }

    /* PROFILE SHEET STYLES (reuse) */
    .avatar-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .avatar {
      width: 46px;
      height: 46px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #a7f3d0 0, #22c55e 40%, #047857 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
      color: #022c15;
      box-shadow: 0 0 18px rgba(34, 197, 94, 0.7);
    }

    .avatar-text-main {
      font-size: 15px;
      font-weight: 600;
    }

    .avatar-text-sub {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .modal-row {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      margin: 6px 0;
    }

    .modal-row label {
      margin: 0;
      color: var(--text-muted);
      font-size: 13px;
    }

    .modal-row span {
      font-weight: 500;
    }

    .modal-separator {
      border-top: 1px dashed rgba(148, 163, 184, 0.65);
      margin: 10px 0 14px;
    }

    @media (min-width: 480px) {
      .app {
        padding-top: 20px;
      }
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="header">
      <div class="logo-title">
        <div class="logo-badge">A</div>
        <div>
          <div class="app-name">AiSend</div>
          <div class="app-sub">Chegarasiz to‘lovlar · demo UI</div>
        </div>
      </div>
      <button class="profile-btn" id="profileOpen">
        Profil
        <span>▼</span>
      </button>
    </header>

    <div class="chip-row">
      <div class="chip primary">AiSend · Super demo</div>
      <div class="chip">Beta build</div>
    </div>

    <!-- TOTAL BALANCE CARD -->
    <section class="card">
      <div class="card-header">
        <div>
          <div class="card-title">Total balance</div>
          <p class="card-sub">Fiat · Crypto · Stock (demo qiymatlar)</p>
        </div>
      </div>
      <div class="total-amount" id="totalBalanceUsd">$0.00</div>
      <div class="total-sub" id="totalBalanceBreakdown">
        Fiat, Crypto va Stock qiymatlari USD/USDT ekvivalentida.
      </div>

      <div class="link-row">
        <span>Barcha aktivlar</span>
        <button id="openAssetsSheet">Ko‘rish</button>
      </div>
    </section>

    <!-- MAIN MENU -->
    <section class="card" style="margin-top: 4px;">
      <div class="menu-grid">
        <div class="menu-item main" id="openSendSheet">
          <div class="menu-title">Send</div>
          <div class="menu-sub">AiSend orqali tezkor pul yuborish</div>
        </div>
        <div class="menu-item" id="openExchangeSheet">
          <div class="menu-title">Exchange</div>
          <div class="menu-sub">UZS ↔ KZT ↔ KGS almashinuvi (demo)</div>
        </div>
        <div class="menu-item" id="openCryptoSheet">
          <div class="menu-title">Crypto</div>
          <div class="menu-sub">USDT orqali demo balanslar</div>
        </div>
        <div class="menu-item" id="openStocksSheet">
          <div class="menu-title">Stock</div>
          <div class="menu-sub">AAPL, TSLA kabi demo aktivlar</div>
        </div>
        <div class="menu-item" id="openBorderlessSheet">
          <div class="menu-title">Chegarasiz to‘lovlar</div>
          <div class="menu-sub">Komunal, abonent va boshqalar (demo)</div>
        </div>
      </div>
    </section>

    <p class="footer-note">
      AiSend demo interfeysi. Fikr va takliflar — keyingi bosqichlar uchun asos bo‘ladi.
    </p>
  </div>
<!-- BARCHA AKTIVLAR SHEET -->
  <div class="sheet-bg" id="assetsSheetBg">
    <div class="sheet">
      <div class="sheet-header">
        <div class="sheet-title">Barcha aktivlar</div>
        <div class="sheet-close" data-close-sheet="assetsSheetBg">✕</div>
      </div>

      <p class="muted">Demo qiymatlar, real hisob-kitob emas.</p>

      <p class="section-label">Fiat</p>
      <div class="asset-row">
        <span><strong>Fiat jami</strong></span>
        <span id="fiatTotalUsd">$0.00</span>
      </div>
      <div class="asset-row">
        <span>UZS</span>
        <span id="fiatUzsRow">0 so‘m · $0.00</span>
      </div>
      <div class="asset-row">
        <span>KZT</span>
        <span id="fiatKztRow">0 ₸ · $0.00</span>
      </div>

      <p class="section-label">Crypto</p>
      <div class="asset-row">
        <span><strong>Crypto jami</strong></span>
        <span id="cryptoTotalUsdt">0.00 USDT</span>
      </div>
      <div class="asset-row">
        <span>BTC</span>
        <span id="cryptoBtcRow">0 BTC · 0.00 USDT</span>
      </div>
      <div class="asset-row">
        <span>TON</span>
        <span id="cryptoTonRow">0 TON · 0.00 USDT</span>
      </div>

      <p class="section-label">Stock</p>
      <div class="asset-row">
        <span><strong>Stock jami</strong></span>
        <span id="stockTotalUsdt">0.00 USDT</span>
      </div>
      <div class="asset-row">
        <span>AAPL</span>
        <span id="stockAaplRow">0 aks · 0.00 USDT</span>
      </div>
      <div class="asset-row">
        <span>TSLA</span>
        <span id="stockTslaRow">0 aks · 0.00 USDT</span>
      </div>
    </div>
  </div>

  <!-- SEND SHEET -->
  <div class="sheet-bg" id="sendSheetBg">
    <div class="sheet">
      <div class="sheet-header">
        <div class="sheet-title">Send</div>
        <div class="sheet-close" data-close-sheet="sendSheetBg">✕</div>
      </div>

      <div class="badge-row">
        <span class="badge">AiSend ichida yuborish</span>
        <span class="badge">0% demo komissiya</span>
      </div>

      <div class="field">
        <label for="sendToType">Qabul qiluvchi turi</label>
        <select id="sendToType">
          <option value="username">@username</option>
          <option value="card">Karta raqami</option>
        </select>
      </div>

      <div class="field">
        <label for="sendTo">Qabul qiluvchi (@user yoki karta)</label>
        <input id="sendTo" type="text" placeholder="@username yoki karta raqami" />
      </div>

      <div class="field">
        <label for="sendAmount">Miqdor</label>
        <input id="sendAmount" type="number" inputmode="numeric" placeholder="Miqdor kiriting" />
      </div>

      <div class="field">
        <label for="sendCurrency">Valyuta</label>
        <select id="sendCurrency">
          <option value="UZS" selected>UZS</option>
          <option value="KZT">KZT</option>
          <option value="USD">USD</option>
        </select>
      </div>

      <div class="field">
        <label for="sendNote">Izoh (ixtiyoriy)</label>
        <input id="sendNote" type="text" placeholder="Masalan: Uyga pul" />
      </div>

      <button class="btn" id="sendConfirmBtn">
        Yuborishni tasdiqlash
      </button>
      <div class="send-status" id="sendStatus">
        Demo: to‘lov tayyor, lekin real yuborilmaydi.
      </div>
    </div>
  </div>

  <!-- EXCHANGE SHEET -->
  <div class="sheet-bg" id="exchangeSheetBg">
    <div class="sheet">
      <div class="sheet-header">
        <div class="sheet-title">Exchange</div>
        <div class="sheet-close" data-close-sheet="exchangeSheetBg">✕</div>
      </div>

      <p class="muted">UZS balansni KZT / KGS ga almashtirish (demo kurslar).</p>

      <div class="field">
        <label for="exDirection">Yo‘nalish</label>
        <select id="exDirection">
          <option value="UZS_KZT" selected>UZS → KZT</option>
          <option value="UZS_KGS">UZS → KGS</option>
        </select>
      </div>

      <div class="field">
        <label for="exAmount">Miqdor (UZS)</label>
        <input id="exAmount" type="number" inputmode="numeric" placeholder="UZS miqdor kiriting" />
      </div>

      <button class="btn" id="exCalcBtn">Hisoblash</button>

      <div class="asset-row" style="margin-top: 10px;">
        <span>Natija</span>
        <span id="exResultText">0 UZS ≈ 0 KZT</span>
      </div>
      <div class="muted" id="exBaseRate">
        1 UZS ≈ demo kurs
      </div>
    </div>
  </div>

  <!-- CRYPTO SHEET -->
  <div class="sheet-bg" id="cryptoSheetBg">
    <div class="sheet">
      <div class="sheet-header">
        <div class="sheet-title">Crypto (demo)</div>
        <div class="sheet-close" data-close-sheet="cryptoSheetBg">✕</div>
      </div>

      <p class="muted">Bu bo‘lim hozircha faqat demo ko‘rinishida.</p>

      <div class="asset-row">
        <span>Crypto jami</span>
        <span id="cryptoSheetTotal">0.00 USDT</span>
      </div>

      <p class="section-label">Aktivlar</p>
      <div class="asset-row">
        <span>BTC</span>
        <span id="cryptoSheetBtc">0 BTC · 0.00 USDT</span>
      </div>
      <div class="asset-row">
        <span>TON</span>
        <span id="cryptoSheetTon">0 TON · 0.00 USDT</span>
      </div>

      <button class="btn-secondary" style="margin-top: 12px;">
        Crypto sotib olish (tez orada)
      </button>
    </div>
  </div>

  <!-- STOCK SHEET -->
  <div class="sheet-bg" id="stocksSheetBg">
    <div class="sheet">
      <div class="sheet-header">
        <div class="sheet-title">Stock (demo)</div>
        <div class="sheet-close" data-close-sheet="stocksSheetBg">✕</div>
      </div>

      <p class="muted">USDT ekvivalentida demo aksiyalar.</p>

      <div class="asset-row">
        <span>Stock jami</span>
        <span id="stocksSheetTotal">0.00 USDT</span>
      </div>

      <p class="section-label">Aktivlar</p>
      <div class="asset-row">
        <span>AAPL</span>
        <span id="stocksSheetAapl">0 aks · 0.00 USDT</span>
      </div>
      <div class="asset-row">
        <span>TSLA</span>
        <span id="stocksSheetTsla">0 aks · 0.00 USDT</span>
      </div>

      <button class="btn-secondary" style="margin-top: 12px;">
        Stock savdo (tez orada)
      </button>
    </div>
  </div>

  <!-- CHEGARASIZ TO'LOVLAR SHEET -->
  <div class="sheet-bg" id="borderlessSheetBg">
    <div class="sheet">
      <div class="sheet-header">
        <div class="sheet-title">Chegarasiz to‘lovlar (demo)</div>
        <div class="sheet-close" data-close-sheet="borderlessSheetBg">✕</div>
      </div>

      <p class="muted">
        Masalan, Rossiyada turib O‘zbekistondagi komunal to‘lovlarni rublda to‘lash (demo).
      </p>

      <div class="field">
        <label for="billCountry">To‘lov davlati</label>
        <select id="billCountry">
          <option value="UZB">O‘zbekiston</option>
          <option value="KZ">Qozog‘iston</option>
          <option value="KG">Qirg‘iziston</option>
        </select>
      </div>

      <div class="field">
        <label for="billType">To‘lov turi</label>
        <select id="billType">
          <option value="electric">Svet</option>
          <option value="gas">Gaz</option>
          <option value="internet">Internet</option>
        </select>
      </div>

      <div class="field">
        <label for="billAmount">Miqdor (mahalliy valyutada)</label>
        <input id="billAmount" type="number" inputmode="numeric" placeholder="Masalan: 120 000 UZS" />
      </div>

      <button class="btn-secondary">
        Demo: hisoblash (tez orada)
      </button>
    </div>
  </div>

  <!-- PROFILE SHEET -->
  <div class="sheet-bg" id="profileBg">
    <div class="sheet">
      <div class="sheet-header">
        <div class="sheet-title">Telegram profil</div>
        <div class="sheet-close" data-close-sheet="profileBg">✕</div>
      </div>

      <div class="avatar-row">
        <div class="avatar" id="pf_avatarLetter">A</div>
        <div>
          <div class="avatar-text-main" id="pf_name">-</div>
          <div class="avatar-text-sub" id="pf_username">@-</div>
        </div>
      </div>

      <div class="modal-row">
        <label>ID:</label>
        <span id="pf_id">-</span>
      </div>

      <div class="modal-separator"></div>

      <button class="btn-secondary">
        Sozlamalar (tez orada)
      </button>
      <button class="btn" style="margin-top: 10px; background:#f97373; color:#450a0a; box-shadow:none;">
        Chiqish (demo)
      </button>
    </div>
  </div>
<script>
    // ===== DEMO BALANSLAR =====
    const DEMO_FIAT = {
      UZS: 1200000, // 1.2 mln so'm
      KZT: 50000    // 50 ming tenge
    };

    const DEMO_FIAT_TO_USD = {
      UZS: 0.00008, // so'm -> USD (demo)
      KZT: 0.0020   // tenge -> USD (demo)
    };

    const DEMO_CRYPTO = {
      BTC: { amount: 0.016, usdtPrice: 65000 }, // 1 BTC = 65k USDT (demo)
      TON: { amount: 27, usdtPrice: 5 }         // 1 TON = 5 USDT (demo)
    };

    const DEMO_STOCK = {
      AAPL: { shares: 3, usdtPrice: 200 },
      TSLA: { shares: 1.5, usdtPrice: 260 }
    };

    function fmtUsd(x) {
      return "$" + Number(x).toLocaleString("en-US", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    function fmtUsdt(x) {
      return Number(x).toLocaleString("en-US", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }) + " USDT";
    }

    function fmtNum(x) {
      return Number(x).toLocaleString("en-US", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    function setupBalances() {
      // FIAT
      const uzsUsd = DEMO_FIAT.UZS * DEMO_FIAT_TO_USD.UZS;
      const kztUsd = DEMO_FIAT.KZT * DEMO_FIAT_TO_USD.KZT;
      const fiatTotal = uzsUsd + kztUsd;

      // CRYPTO
      const btcUsdt = DEMO_CRYPTO.BTC.amount * DEMO_CRYPTO.BTC.usdtPrice;
      const tonUsdt = DEMO_CRYPTO.TON.amount * DEMO_CRYPTO.TON.usdtPrice;
      const cryptoTotal = btcUsdt + tonUsdt;

      // STOCK
      const aaplUsdt = DEMO_STOCK.AAPL.shares * DEMO_STOCK.AAPL.usdtPrice;
      const tslaUsdt = DEMO_STOCK.TSLA.shares * DEMO_STOCK.TSLA.usdtPrice;
      const stockTotal = aaplUsdt + tslaUsdt;

      // Total balance (hammasini USDga teng deb olamiz: USDT ~ USD)
      const grandTotal = fiatTotal + cryptoTotal + stockTotal;

      // Asosiy karta
      document.getElementById("totalBalanceUsd").textContent = fmtUsd(grandTotal);
      document.getElementById("totalBalanceBreakdown").textContent =
        `Fiat: ${fmtUsd(fiatTotal)} · Crypto: ${fmtUsdt(cryptoTotal)} · Stock: ${fmtUsdt(stockTotal)}`;

      // Assets sheet — fiat
      document.getElementById("fiatTotalUsd").textContent = fmtUsd(fiatTotal);
      document.getElementById("fiatUzsRow").textContent =
        `${DEMO_FIAT.UZS.toLocaleString("uz-UZ")} so‘m · ${fmtUsd(uzsUsd)}`;
      document.getElementById("fiatKztRow").textContent =
        `${DEMO_FIAT.KZT.toLocaleString("en-US")} ₸ · ${fmtUsd(kztUsd)}`;

      // Assets sheet — crypto
      document.getElementById("cryptoTotalUsdt").textContent = fmtUsdt(cryptoTotal);
      document.getElementById("cryptoBtcRow").textContent =
        `${DEMO_CRYPTO.BTC.amount} BTC · ${fmtUsdt(btcUsdt)}`;
      document.getElementById("cryptoTonRow").textContent =
        `${DEMO_CRYPTO.TON.amount} TON · ${fmtUsdt(tonUsdt)}`;

      // Crypto sheet
      document.getElementById("cryptoSheetTotal").textContent = fmtUsdt(cryptoTotal);
      document.getElementById("cryptoSheetBtc").textContent =
        `${DEMO_CRYPTO.BTC.amount} BTC · ${fmtUsdt(btcUsdt)}`;
      document.getElementById("cryptoSheetTon").textContent =
        `${DEMO_CRYPTO.TON.amount} TON · ${fmtUsdt(tonUsdt)}`;

      // Stock
      document.getElementById("stockTotalUsdt").textContent = fmtUsdt(stockTotal);
      document.getElementById("stockAaplRow").textContent =
        `${DEMO_STOCK.AAPL.shares} aks · ${fmtUsdt(aaplUsdt)}`;
      document.getElementById("stockTslaRow").textContent =
        `${DEMO_STOCK.TSLA.shares} aks · ${fmtUsdt(tslaUsdt)}`;

      // Stock sheet
      document.getElementById("stocksSheetTotal").textContent = fmtUsdt(stockTotal);
      document.getElementById("stocksSheetAapl").textContent =
        `${DEMO_STOCK.AAPL.shares} aks · ${fmtUsdt(aaplUsdt)}`;
      document.getElementById("stocksSheetTsla").textContent =
        `${DEMO_STOCK.TSLA.shares} aks · ${fmtUsdt(tslaUsdt)}`;
    }

    // ==== SHEET OPEN/CLOSE ====
    function openSheet(id) {
      const el = document.getElementById(id);
      if (el) el.classList.add("active");
    }
    function closeSheet(id) {
      const el = document.getElementById(id);
      if (el) el.classList.remove("active");
    }

    function setupSheetTriggers() {
      document.getElementById("openAssetsSheet").addEventListener("click", () => openSheet("assetsSheetBg"));
      document.getElementById("openSendSheet").addEventListener("click", () => openSheet("sendSheetBg"));
      document.getElementById("openExchangeSheet").addEventListener("click", () => openSheet("exchangeSheetBg"));
      document.getElementById("openCryptoSheet").addEventListener("click", () => openSheet("cryptoSheetBg"));
      document.getElementById("openStocksSheet").addEventListener("click", () => openSheet("stocksSheetBg"));
      document.getElementById("openBorderlessSheet").addEventListener("click", () => openSheet("borderlessSheetBg"));
      document.getElementById("profileOpen").addEventListener("click", () => openSheet("profileBg"));

      // Close buttons
      document.querySelectorAll(".sheet-close").forEach((btn) => {
        const id = btn.getAttribute("data-close-sheet");
        if (!id) return;
        btn.addEventListener("click", () => closeSheet(id));
      });

      // Background click to close
      document.querySelectorAll(".sheet-bg").forEach((bg) => {
        bg.addEventListener("click", (e) => {
          if (e.target === bg) {
            bg.classList.remove("active");
          }
        });
      });
    }

    // ==== SEND LOGIKA ====
    function setupSend() {
      const btn = document.getElementById("sendConfirmBtn");
      const statusEl = document.getElementById("sendStatus");
      const toTypeEl = document.getElementById("sendToType");
      const toEl = document.getElementById("sendTo");
      const amountEl = document.getElementById("sendAmount");
      const curEl = document.getElementById("sendCurrency");
      const noteEl = document.getElementById("sendNote");

      btn.addEventListener("click", () => {
        const ttype = toTypeEl.value;
        const to = (toEl.value || "").trim();
        const amountRaw = (amountEl.value || "").trim();
        const amount = parseFloat(amountRaw.replace(",", "."));
        const cur = curEl.value;
        const note = (noteEl.value || "").trim();

        if (!to) {
          statusEl.classList.add("err");
          statusEl.textContent = "Qabul qiluvchi kiritilmadi.";
          return;
        }
        if (!amountRaw || isNaN(amount) || amount <= 0) {
          statusEl.classList.add("err");
          statusEl.textContent = "Miqdor noto‘g‘ri kiritilgan.";
          return;
        }

        const toLabel = ttype === "username" ? "foydalanuvchi" : "karta";
        const notePart = note ? ` · Izoh: “${note}”` : "";

        statusEl.classList.remove("err");
        statusEl.textContent =
          `Demo: ${fmtNum(amount)} ${cur} ${toLabel} ${to} ga yuborildi ✅${notePart}`;
      });
    }

    // ==== EXCHANGE LOGIKA (UZS -> KZT/KGS DEMO) ====
    const DEMO_RATES = {
      UZS_KZT: 0.04,
      UZS_KGS: 0.007
    };

    function setupExchange() {
      const dirEl = document.getElementById("exDirection");
      const amtEl = document.getElementById("exAmount");
      const resEl = document.getElementById("exResultText");
      const baseEl = document.getElementById("exBaseRate");
      const btn = document.getElementById("exCalcBtn");

      function recalc() {
        const raw = (amtEl.value || "").trim();
        const amt = parseFloat(raw.replace(",", "."));
        const dir = dirEl.value;
        if (!raw || isNaN(amt) || amt <= 0) {
          resEl.textContent = "0 UZS ≈ 0 KZT";
          baseEl.textContent = "1 UZS ≈ demo kurs";
          return;
        }
        let rate = DEMO_RATES[dir] || DEMO_RATES.UZS_KZT;
        const quote = dir === "UZS_KZT" ? "KZT" : "KGS";
        const result = amt * rate;
        resEl.textContent = `${fmtNum(amt)} UZS ≈ ${fmtNum(result)} ${quote}`;
        baseEl.textContent = `1 UZS ≈ ${fmtNum(rate)} ${quote} (demo kurs)`;
      }

      btn.addEventListener("click", recalc);
      dirEl.addEventListener("change", recalc);
      amtEl.addEventListener("input", recalc);
    }

    // ==== PROFILE TELEGRAM WEBAPP INTEGRATSIYA ====
    function initProfileSheet() {
      const nameEl = document.getElementById("pf_name");
      const idEl = document.getElementById("pf_id");
      const userEl = document.getElementById("pf_username");
      const avatarLetter = document.getElementById("pf_avatarLetter");

      let tgId = null;
      let tgName = null;
      let tgUsername = null;

      // 1) URL query
      const params = new URLSearchParams(window.location.search);
      tgId = params.get("tg_id");
      tgName = params.get("tg_name");
      tgUsername = params.get("tg_username");

      // 2) Agar bo'sh bo'lsa - Telegram WebApp orqali
      try {
        if (
          (!tgId || !tgName) &&
          window.Telegram &&
          Telegram.WebApp &&
          Telegram.WebApp.initDataUnsafe &&
          Telegram.WebApp.initDataUnsafe.user
        ) {
          const u = Telegram.WebApp.initDataUnsafe.user;
          if (!tgId && u.id) tgId = String(u.id);
          if (!tgName) {
            const full = [u.first_name, u.last_name].filter(Boolean).join(" ");
            tgName = full || "";
          }
          if (!tgUsername && u.username) tgUsername = u.username;
        }
      } catch (e) {
        console.log("Telegram user data error:", e);
      }

      nameEl.textContent = tgName || "-";
      idEl.textContent = tgId || "-";
      userEl.textContent = tgUsername ? "@" + tgUsername : "-";

      const firstLetter = (tgName || "A").trim().charAt(0).toUpperCase();
      avatarLetter.textContent = firstLetter || "A";

      try {
        if (window.Telegram && Telegram.WebApp) {
          Telegram.WebApp.ready();
          Telegram.WebApp.expand();
        }
      } catch (e) {
        console.log("Telegram ready error:", e);
      }
    }

    window.addEventListener("load", () => {
      setupBalances();
      setupSheetTriggers();
      setupSend();
      setupExchange();
      initProfileSheet();
    });
  </script>
</body>
</html>

