<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="UTF-8" />
    <title>AiSend Pay · Demo konvertor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "Roboto", sans-serif;
      }

      body {
        background: radial-gradient(circle at top, #101827, #020615 55%, #000);
        color: #f9fafb;
        min-height: 100vh;
        padding: 18px 14px 26px;
        display: flex;
        flex-direction: column;
      }

      .shell {
        max-width: 480px;
        margin: 0 auto;
      }

      .badge-row {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 10px;
      }

      .badge-main {
        padding: 3px 10px;
        border-radius: 999px;
        background: rgba(15, 118, 110, 0.18);
        border: 1px solid rgba(45, 212, 191, 0.4);
        font-size: 11px;
        color: #a5f3fc;
      }

      .badge-main::before {
        content: "";
        display: inline-block;
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.25);
        margin-right: 6px;
      }

      .badge-beta {
        padding: 3px 9px;
        border-radius: 999px;
        background: rgba(148, 163, 184, 0.08);
        border: 1px solid rgba(148, 163, 184, 0.5);
        font-size: 11px;
        color: #e5e7eb;
      }

      .card {
        background: radial-gradient(circle at top left, #0f172a, #020617 55%);
        border-radius: 22px;
        padding: 18px 16px 18px;
        box-shadow: 0 28px 60px rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.35);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 18px;
      }

      .title-block {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .app-logo {
        width: 38px;
        height: 38px;
        border-radius: 13px;
        background: radial-gradient(circle at 30% 0, #22c55e, #0ea5e9 70%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        color: #0b1120;
        font-size: 20px;
        box-shadow: 0 12px 30px rgba(34, 197, 94, 0.45);
      }

      .app-text h1 {
        font-size: 19px;
        font-weight: 700;
        letter-spacing: 0.02em;
        margin-bottom: 2px;
      }

      .app-text p {
        font-size: 12px;
        color: #9ca3af;
      }

      .pill-toggle {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(34, 197, 94, 0.45);
        font-size: 11px;
        color: #bbf7d0;
      }

      .pill-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.25);
      }

      .section-label {
        margin-top: 4px;
        margin-bottom: 8px;
        font-size: 11px;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: #6b7280;
      }

      .pair-row {
        display: grid;
        grid-template-columns: 1fr 32px 1fr;
        gap: 12px;
        align-items: center;
        margin-bottom: 14px;
      }

      .currency-card {
        background: radial-gradient(circle at top left, #020617, #020617 60%);
        border-radius: 16px;
        padding: 10px 11px;
        border: 1px solid rgba(148, 163, 184, 0.3);
        box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.9);
      }

      .currency-top {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 4px;
      }

      .chip {
        font-size: 11px;
        padding: 3px 7px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(148, 163, 184, 0.4);
        color: #e5e7eb;
      }

      .currency-code {
        font-weight: 700;
        font-size: 14px;
      }

      .currency-desc {
        font-size: 11px;
        color: #9ca3af;
      }

      .swap-icon {
        width: 32px;
        height: 32px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 0, #22c55e, #0ea5e9 80%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #0b1120;
        font-size: 17px;
        box-shadow: 0 10px 22px rgba(34, 197, 94, 0.5);
      }

      .field-label {
        margin-top: 10px;
        margin-bottom: 6px;
        font-size: 12px;
        color: #9ca3af;
      }

      select,
      input {
        width: 100%;
        border-radius: 13px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: rgba(15, 23, 42, 0.9);
        color: #f9fafb;
        padding: 10px 11px;
        font-size: 14px;
        outline: none;
      }

      select:focus,
      input:focus {
        border-color: #22c55e;
        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.5);
      }

      .hint {
        margin-top: 6px;
        font-size: 11px;
        color: #9ca3af;
        line-height: 1.4;
      }

      .hint span {
        color: #22c55e;
      }

      .btn-primary {
        margin-top: 16px;
        width: 100%;
        border: none;
        border-radius: 999px;
        padding: 11px 14px;
        background: linear-gradient(90deg, #22c55e, #0ea5e9);
        color: #02131a;
        font-weight: 700;
        font-size: 16px;
        box-shadow: 0 16px 35px rgba(34, 197, 94, 0.45);
      }

      .btn-primary:active {
        transform: translateY(1px);
        box-shadow: 0 10px 25px rgba(34, 197, 94, 0.35);
      }

      .result-card {
        margin-top: 14px;
        border-radius: 16px;
        background: radial-gradient(circle at top left, #020617, #020617 65%);
        border: 1px solid rgba(148, 163, 184, 0.5);
        padding: 11px 12px;
      }

      .result-main {
        font-size: 16px;
        font-weight: 700;
        margin-bottom: 4px;
      }

      .result-sub {
        font-size: 11px;
        color: #9ca3af;
      }

      .error-text {
        margin-top: 6px;
        font-size: 11px;
        color: #f97373;
      }

      .footer {
        margin-top: 16px;
        font-size: 11px;
        color: #6b7280;
        text-align: center;
        line-height: 1.4;
      }

      .footer span {
        color: #a5f3fc;
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <div class="badge-row">
        <div class="badge-main">AiSend · Demo konvertor</div>
        <div class="badge-beta">Beta build</div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="title-block">
            <div class="app-logo">A</div>
            <div class="app-text">
              <h1>AiSend Pay</h1>
              <p>Chegarasiz valyuta almashinuvi</p>
            </div>
          </div>
          <div class="pill-toggle">
            <span class="pill-dot"></span>
            <span>Onlayn kurslar</span>
          </div>
        </div>

        <div class="section-label">Yo‘nalish</div>

        <div class="pair-row">
          <div class="currency-card">
            <div class="currency-top">
              <span class="chip">UZS</span>
              <span class="currency-code">UZS</span>
            </div>
            <div class="currency-desc">Asosiy balans</div>
          </div>

          <div class="swap-icon">⇄</div>

          <div class="currency-card">
            <div class="currency-top">
              <span class="chip">KZT/KGS</span>
              <span class="currency-code">KZT / KGS</span>
            </div>
            <div class="currency-desc">Qabul qiluvchi karta</div>
          </div>
        </div>

        <div class="field-label">Yo‘nalishni tanlang</div>
        <select id="direction">
          <option value="UZS_KZT">UZS → KZT</option>
          <option value="KZT_UZS">KZT → UZS</option>
          <option value="UZS_KGS">UZS → KGS</option>
          <option value="KGS_UZS">KGS → UZS</option>
        </select>

        <div class="field-label">Miqdor</div>
        <input
          id="amount"
          type="number"
          inputmode="decimal"
          min="0"
          value="1000"
          placeholder="Miqdor kiriting"
        />

        <div class="hint" id="mode-hint">
          Kurslar <span>onlayn API</span> orqali olinmoqda. Hali rasmiy AiSend
          serveri ulanmagan.
        </div>

        <button class="btn-primary" id="calc-btn">Hisoblash</button>

        <div class="result-card">
          <div class="result-main" id="result-text">1 000 UZS ≈ 40 KZT</div>
          <div class="result-sub" id="result-sub">
            1 UZS ≈ 0,0400 KZT (demo kurs)
          </div>
        </div>

        <div class="error-text" id="error-text" style="display: none">
          Kurslarni yuklashda muammo. Hozircha demo kurslardan
          foydalanilmoqda.
        </div>
      </div>

      <div class="footer">
        AiSend <span>demo</span> interfeysi. Fikr va takliflar — keyingi bosqich
        uchun asos bo‘ladi.
      </div>
    </div>

    <script>
      const DEMO_RATES = {
        UZS_KZT: 0.04,
        KZT_UZS: 25,
        UZS_KGS: 0.007,
        KGS_UZS: 140,
      };

      const directionEl = document.getElementById("direction");
      const amountEl = document.getElementById("amount");
      const resultTextEl = document.getElementById("result-text");
      const resultSubEl = document.getElementById("result-sub");
      const errorTextEl = document.getElementById("error-text");
      const modeHintEl = document.getElementById("mode-hint");
      const calcBtn = document.getElementById("calc-btn");

      function formatNumber(num) {
        return new Intl.NumberFormat("ru-RU").format(num);
      }

      async function fetchLiveRate(from, to) {
        const params = new URLSearchParams({ from, to });
        const res = await fetch(`/api/rates?${params.toString()}`);
        if (!res.ok) {
          throw new Error("HTTP error");
        }
        const data = await res.json();
        if (!data.ok || !data.rate) {
          throw new Error("API error");
        }
        return data.rate;
      }

      async function recalc() {
        const val = parseFloat(amountEl.value || "0");
        if (!val || val <= 0) {
          resultTextEl.textContent = "Miqdor kiriting";
          resultSubEl.textContent = "";
          return;
        }

        const dir = directionEl.value;
        const [from, to] = dir.split("_");

        errorTextEl.style.display = "none";

        let rate = DEMO_RATES[dir];
        let usedDemo = false;

        try {
          const liveRate = await fetchLiveRate(from, to);
          rate = liveRate;
          modeHintEl.innerHTML =
            "Kurslar <span>onlayn API</span> orqali olinmoqda. Hali rasmiy AiSend serveri ulanmagan.";
        } catch (e) {
          console.log("FALLBACK TO DEMO:", e);
          usedDemo = true;
          errorTextEl.style.display = "block";
          modeHintEl.innerHTML =
            "Onlayn API bilan muammo. Hozircha <span>demo kurslar</span> ishlatilmoqda.";
        }

        const result = val * rate;

        resultTextEl.textContent =
          formatNumber(val) + " " + from + " ≈ " + formatNumber(result) + " " + to;

        resultSubEl.textContent =
          "1 " +
          from +
          " ≈ " +
          rate.toFixed(4) +
          " " +
          to +
          (usedDemo ? " (demo kurs)" : " (onlayn API)");
      }

      calcBtn.addEventListener("click", recalc);
      directionEl.addEventListener("change", recalc);
      amountEl.addEventListener("input", () => {
        errorTextEl.style.display = "none";
      });

      recalc();
    </script>
  </body>
</html>
