<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <title>AiSend Â· Super balance (demo)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #031307;
      --card: #06220e;
      --card-soft: #0b3116;
      --accent: #9afc4f;
      --accent-soft: #bfff6e;
      --accent-hard: #c2ff5c;
      --danger: #ff4d4d;
      --text-main: #ffffff;
      --text-soft: #cfe8d4;
      --text-muted: #8fa49a;
      --border: #114020;
      --pill-bg: #03170a;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Roboto", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #113b13 0, #020805 55%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
      padding: 12px 12px 32px;
    }

    .container {
      max-width: 520px;
      margin: 0 auto;
    }

    /* HEADER */

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .top-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .close-btn {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      background: rgba(0, 0, 0, 0.6);
    }

    .top-title {
      font-weight: 600;
      font-size: 20px;
    }

    .profile-chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 99px;
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(154, 252, 79, 0.4);
      cursor: pointer;
      font-size: 13px;
    }

    .profile-chip-pill {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      background: radial-gradient(circle at 20% 0, #d7ff97 0, #69db31 40%, #214d10 100%);
      color: #053106;
    }

    .profile-chip-label span {
      display: block;
      line-height: 1.1;
    }

    .profile-chip-label .name {
      font-size: 12px;
      font-weight: 600;
    }

    .profile-chip-label .tag {
      font-size: 10px;
      color: var(--text-muted);
    }

    /* SUPER BALANCE CARD */

    .super-card {
      margin-top: 12px;
      padding: 18px 16px 16px;
      border-radius: 28px;
      background: radial-gradient(circle at top left, #c6ff6a 0, #9afc4f 35%, #487b23 100%);
      color: #041204;
      position: relative;
      overflow: hidden;
    }

    .super-pill-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
    }

    .badge-demo {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.16);
      color: #f2ffe3;
    }

    .super-balance {
      margin-top: 4px;
    }

    .super-amount {
      font-size: 30px;
      font-weight: 800;
      letter-spacing: 0.02em;
    }

    .super-currency {
      font-size: 16px;
      margin-left: 4px;
      opacity: 0.9;
    }

    .super-sub {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .change-pill {
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(4, 46, 4, 0.9);
      color: #a4ff7a;
      font-size: 11px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .change-pill span.arrow {
      font-size: 10px;
    }

    .super-sub-text {
      font-size: 11px;
      color: rgba(4, 29, 2, 0.8);
    }

    .asset-filter {
      margin-top: 10px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.16);
      cursor: default;
    }

    .asset-filter span:first-child {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
      font-size: 10px;
    }

    .asset-filter .caret {
      font-size: 11px;
    }

    /* MODE BUTTONS */

    .mode-row {
      margin-top: 16px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }

    .mode-btn {
      flex: 1;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 18px;
      padding: 8px 4px 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      border: 1px solid rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: all 0.18s ease-out;
      backdrop-filter: blur(6px);
      font-size: 11px;
      font-weight: 500;
    }

    .mode-icon {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: rgba(3, 23, 10, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      color: #e8ffe0;
    }

    .mode-btn.active {
      border-color: rgba(4, 39, 0, 0.8);
      box-shadow: 0 0 0 1px rgba(4, 39, 0, 0.7), 0 0 18px rgba(200, 255, 127, 0.9);
      background: rgba(0, 0, 0, 0.04);
    }

    .mode-btn.active .mode-icon {
      background: radial-gradient(circle at 20% 0, #eaffae 0, #7ff442 35%, #214f13 100%);
      color: #021401;
    }

    .mode-label {
      font-size: 11px;
    }

    /* QUICK TRANSFER CARD */

    .section-card {
      margin-top: 16px;
      border-radius: 26px;
      background: radial-gradient(circle at top left, #0d3819 0, #04140a 55%, #000 100%);
      border: 1px solid var(--border);
      padding: 16px 14px 18px;
      box-shadow: 0 14px 36px rgba(0, 0, 0, 0.75);
    }

    .section-title {
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .section-caption {
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.4;
      margin-bottom: 12px;
    }

    .field-label {
      font-size: 12px;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    .field-row {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    .pill-select {
      flex: 1;
      border-radius: 16px;
      background: var(--pill-bg);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 8px 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 12px;
    }

    .pill-select-main {
      display: block;
      font-weight: 500;
    }

    .pill-select-sub {
      display: block;
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .pill-select .caret {
      font-size: 11px;
      color: var(--text-muted);
    }

    .input-pill {
      width: 100%;
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(0, 0, 0, 0.5);
      padding: 10px 12px;
      color: var(--text-main);
      font-size: 14px;
      outline: none;
    }

    .input-pill::placeholder {
      color: var(--text-muted);
    }

    .note {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    /* FEE BOX */

    .fee-box {
      margin-top: 14px;
      border-radius: 18px;
      background: radial-gradient(circle at top left, #15351c 0, #041308 55%, #000 100%);
      border: 1px solid rgba(154, 252, 79, 0.24);
      padding: 10px 12px 12px;
      font-size: 12px;
    }

    .fee-row-head {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      align-items: baseline;
    }

    .fee-label {
      font-size: 12px;
      color: var(--text-soft);
    }

    .fee-main-amount {
      font-weight: 700;
      font-size: 16px;
    }

    .fee-main-ccy {
      font-size: 12px;
      margin-left: 3px;
      color: #d8ffd1;
    }

    .fee-tags {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .fee-tags div {
      flex: 1;
      display: flex;
      justify-content: space-between;
    }

    .fee-tags span.value {
      color: var(--accent-soft);
    }

    .fee-total {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
    }

    .fee-total span.value {
      color: var(--accent-hard);
      font-weight: 500;
    }

    /* MAIN BUTTON */

    .primary-btn {
      margin-top: 14px;
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 13px 16px;
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      background: radial-gradient(circle at 20% 0, #e8ffb8 0, #a4ff4a 40%, #4ad021 100%);
      color: #021201;
      box-shadow: 0 12px 32px rgba(120, 255, 120, 0.6);
      cursor: pointer;
    }

    .primary-btn:active {
      transform: translateY(1px);
      box-shadow: 0 6px 18px rgba(120, 255, 120, 0.4);
    }

    .demo-info {
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .demo-info span {
      color: #f5ffb0;
    }

    .result-toast {
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 14px;
      font-size: 11px;
      background: rgba(5, 66, 23, 0.95);
      border: 1px solid rgba(154, 252, 79, 0.4);
      color: #dcffe2;
      display: none;
    }

    .result-toast.err {
      background: rgba(80, 10, 10, 0.94);
      border-color: rgba(255, 115, 115, 0.75);
      color: #ffe5e5;
    }

    /* PROFILE MODAL */

    .modal-bg {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(12px);
      display: none;
      align-items: flex-end;
      justify-content: center;
      z-index: 50;
    }

    .modal-bg.show {
      display: flex;
    }

    .modal {
      width: 100%;
      max-width: 520px;
      background: radial-gradient(circle at top left, #0b3217 0, #020806 60%, #000 100%);
      border-radius: 24px 24px 0 0;
      border-top: 1px solid rgba(154, 252, 79, 0.35);
      padding: 14px 16px 20px;
      color: var(--text-main);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .modal-title {
      font-size: 17px;
      font-weight: 600;
    }

    .modal-close {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      background: rgba(0, 0, 0, 0.6);
      cursor: pointer;
    }

    .modal-line {
      margin-top: 6px;
      margin-bottom: 10px;
      height: 1px;
      background: linear-gradient(
        to right,
        transparent,
        rgba(255, 255, 255, 0.1),
        transparent
      );
    }

    .profile-list {
      font-size: 13px;
      margin-bottom: 16px;
    }

    .profile-row {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
    }

    .profile-row span.label {
      color: var(--text-soft);
    }

    .profile-row span.value {
      color: #f6ffe7;
      font-weight: 500;
      max-width: 60%;
      text-align: right;
      word-break: break-all;
    }

    .modal-btn-ghost,
    .modal-btn-danger {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      padding: 11px 14px;
      font-size: 14px;
      background: rgba(0, 0, 0, 0.4);
      color: var(--text-main);
      margin-top: 8px;
    }

    .modal-btn-danger {
      border-color: rgba(255, 77, 77, 0.7);
      background: linear-gradient(135deg, #7e1111, #d62c2c);
    }

    .footer-note {
      margin-top: 14px;
      font-size: 10px;
      color: var(--text-muted);
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- HEADER -->
    <div class="top-bar">
      <div class="top-left">
        <div class="close-btn">âœ•</div>
        <div class="top-title">AiSend</div>
      </div>
      <button class="profile-chip" id="profileOpen">
        <div class="profile-chip-pill" id="pf_avatar">TG</div>
        <div class="profile-chip-label">
          <span class="name" id="pf_chip_name">Profil</span>
          <span class="tag">@username</span>
        </div>
      </button>
    </div>

    <!-- SUPER BALANCE CARD -->
    <div class="super-card">
      <div class="super-pill-row">
        <div>AiSend Â· <span>DEMO</span></div>
        <div class="badge-demo">Real balans emas</div>
      </div>

      <div class="super-balance">
        <div class="super-amount">
          <span id="superAmount">12 450.00</span>
          <span class="super-currency">USZ</span>
        </div>
      </div>

      <div class="super-sub">
        <div class="change-pill">
          <span class="arrow">â–²</span>
          <span id="superChange">+3.4%</span>
        </div>
        <div class="super-sub-text">Oxirgi hafta (demo)</div>
      </div>

      <div class="asset-filter">
        <span>Barcha aktivlar</span>
        <span class="caret">â–¾</span>
      </div>

      <!-- MODE BUTTONS -->
      <div class="mode-row" id="modeRow">
        <div class="mode-btn active" data-mode="send">
          <div class="mode-icon">â†—</div>
          <div class="mode-label">Send</div>
        </div>
        <div class="mode-btn" data-mode="exchange">
          <div class="mode-icon">â‡„</div>
          <div class="mode-label">Exchange</div>
        </div>
        <div class="mode-btn" data-mode="crypto">
          <div class="mode-icon">â‚¿</div>
          <div class="mode-label">Crypto</div>
        </div>
        <div class="mode-btn" data-mode="stocks">
          <div class="mode-icon">ðŸ“ˆ</div>
          <div class="mode-label">Stocks</div>
        </div>
      </div>
    </div>

    <!-- QUICK TRANSFER -->
    <div class="section-card" id="qtCard">
      <div class="section-title" id="qtTitle">Quick Transfer</div>
      <div class="section-caption" id="qtCaption">
        UZS â†’ KZT / KGS kartaga tezkor oâ€˜tkazmalar (demo). Komissiya tarkibini
        oldindan koâ€˜rib turasiz.
      </div>

      <div class="field-label">From valyuta</div>
      <div class="field-row">
        <div class="pill-select" id="fromSelect">
          <div>
            <span class="pill-select-main" id="fromMain">UZS (Uzbekistan)</span>
            <span class="pill-select-sub" id="fromSub">AiSend balansidan</span>
          </div>
          <span class="caret">â–¾</span>
        </div>
      </div>

      <div class="field-label">To valyuta</div>
      <div class="field-row">
        <div class="pill-select" id="toSelect">
          <div>
            <span class="pill-select-main" id="toMain">KZT (Kazakhstan)</span>
            <span class="pill-select-sub" id="toSub">Qabul qiluvchi karta</span>
          </div>
          <span class="caret">â–¾</span>
        </div>
      </div>

      <div class="field-label">Miqdor</div>
      <input
        id="qtAmount"
        class="input-pill"
        type="number"
        inputmode="decimal"
        placeholder="Miqdor kiriting"
      />

      <div class="field-label" style="margin-top: 10px;">Qabul qiluvchi (demo)</div>
      <input
        id="qtRecipient"
        class="input-pill"
        placeholder="@foydalanuvchi, telefon yoki karta"
      />

      <div class="note">
        Komissiyalar: <b>1% exchange + 1% transfer</b> (demo). Real ilovada bu
        raqamlar litsenziyaga qarab oâ€˜zgaradi.
      </div>

      <div class="fee-box">
        <div class="fee-row-head">
          <div class="fee-label">Qabul qiluvchi oladi (taxminan)</div>
          <div>
            <span class="fee-main-amount" id="feeNetAmount">0.00</span>
            <span class="fee-main-ccy" id="feeNetCcy">KZT</span>
          </div>
        </div>

        <div class="fee-tags">
          <div>
            <span>Exchange fee (1%)</span>
            <span class="value" id="feeExchange">0.00</span>
          </div>
          <div>
            <span>Transfer fee (1%)</span>
            <span class="value" id="feeTransfer">0.00</span>
          </div>
        </div>

        <div class="fee-total">
          <span>Umumiy komissiya</span>
          <span class="value" id="feeTotal">0.00</span>
        </div>
      </div>

      <button class="primary-btn" id="qtSubmit">
        Yuborishni tasdiqlash (demo)
      </button>

      <div class="demo-info">
        Demo: <span id="qtDemoLine">
          hisob-kitoblar faqat vizual maqsadda ishlaydi.
        </span>
      </div>

      <div class="result-toast" id="qtResultToast"></div>
    </div>

    <div class="footer-note">
      AiSend demo interfeysi. Fikr va takliflar â€” keyingi bosqichlar uchun asos
      boâ€˜ladi.
    </div>
  </div>
<!-- PROFILE MODAL -->
  <div class="modal-bg" id="profileBg">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Telegram profil</div>
        <div class="modal-close" id="profileClose">âœ•</div>
      </div>

      <div class="modal-line"></div>

      <div class="profile-list">
        <div class="profile-row">
          <span class="label">Ism:</span>
          <span class="value" id="pf_name">-</span>
        </div>
        <div class="profile-row">
          <span class="label">ID:</span>
          <span class="value" id="pf_id">-</span>
        </div>
        <div class="profile-row">
          <span class="label">Username:</span>
          <span class="value" id="pf_username">-</span>
        </div>
      </div>

      <button class="modal-btn-ghost" disabled>
        Sozlamalar (tez orada)
      </button>
      <button class="modal-btn-danger" disabled>
        Chiqish (tez orada)
      </button>
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    // ======= MODE TOGGLING (Send / Exchange / Crypto / Stocks) =======
    const modeRow = document.getElementById("modeRow");
    const qtTitle = document.getElementById("qtTitle");
    const qtCaption = document.getElementById("qtCaption");
    let currentMode = "send";

    function setMode(mode) {
      currentMode = mode;
      document
        .querySelectorAll(".mode-btn")
        .forEach((btn) => btn.classList.toggle("active", btn.dataset.mode === mode));

      if (mode === "send") {
        qtTitle.textContent = "Quick Transfer";
        qtCaption.textContent =
          "UZS â†’ KZT / KGS kartaga tezkor oâ€˜tkazmalar (demo). Komissiyani oldindan koâ€˜rasiz.";
      } else if (mode === "exchange") {
        qtTitle.textContent = "Exchange (demo)";
        qtCaption.textContent =
          "AiSend balansidagi UZS ni ichki KZT/KGS balansiga almashtirish uchun demo hisob-kitob.";
      } else if (mode === "crypto") {
        qtTitle.textContent = "Crypto (demo)";
        qtCaption.textContent =
          "USDT / BTC kabi aktivlar uchun faqat demo kalkulyator. Real savdo litsenziyadan keyin yoqiladi.";
      } else if (mode === "stocks") {
        qtTitle.textContent = "Stocks (demo)";
        qtCaption.textContent =
          "AQSH va boshqa bozor aksiyalariga investitsiya konseptini koâ€˜rsatish uchun demo rejim.";
      }
    }

    modeRow.addEventListener("click", (e) => {
      const btn = e.target.closest(".mode-btn");
      if (!btn) return;
      setMode(btn.dataset.mode);
      recalc();
    });

    // ======= QUICK TRANSFER CALC LOGIC =======

    const DEMO_RATES = {
      "UZS->KZT": 0.040, // 1 UZS â‰ˆ 0.04 KZT
      "KZT->UZS": 25.0,
    };

    const fromCode = "UZS";
    const toCode = "KZT";

    const qtAmount = document.getElementById("qtAmount");
    const qtRecipient = document.getElementById("qtRecipient");
    const feeNetAmount = document.getElementById("feeNetAmount");
    const feeNetCcy = document.getElementById("feeNetCcy");
    const feeExchange = document.getElementById("feeExchange");
    const feeTransfer = document.getElementById("feeTransfer");
    const feeTotal = document.getElementById("feeTotal");
    const qtDemoLine = document.getElementById("qtDemoLine");
    const qtResultToast = document.getElementById("qtResultToast");
    const qtSubmit = document.getElementById("qtSubmit");

    function formatAmount(num, digits = 2) {
      if (!isFinite(num)) return "0.00";
      return num
        .toFixed(digits)
        .replace(/\B(?=(\d{3})+(?!\d))/g, " ");
    }

    function recalc() {
      const amount = parseFloat(qtAmount.value.replace(",", "."));
      const key = `${fromCode}->${toCode}`;
      const rate = DEMO_RATES[key] || 0;

      feeNetCcy.textContent = toCode;

      if (!amount || amount <= 0 || !rate) {
        feeNetAmount.textContent = "0.00";
        feeExchange.textContent = "0.00";
        feeTransfer.textContent = "0.00";
        feeTotal.textContent = "0.00";
        return;
      }

      const grossTo = amount * rate;
      const exchangeFee = grossTo * 0.01;
      const transferFee = grossTo * 0.01;
      const totalFee = exchangeFee + transferFee;
      const netTo = grossTo - totalFee;

      feeNetAmount.textContent = formatAmount(netTo, 2);
      feeExchange.textContent = formatAmount(exchangeFee, 2) + " " + toCode;
      feeTransfer.textContent = formatAmount(transferFee, 2) + " " + toCode;
      feeTotal.textContent = formatAmount(totalFee, 2) + " " + toCode;
    }

    qtAmount.addEventListener("input", recalc);
qtSubmit.addEventListener("click", () => {
      const amount = parseFloat(qtAmount.value.replace(",", "."));
      const recipient = qtRecipient.value.trim();

      qtResultToast.classList.remove("err");
      qtResultToast.style.display = "none";

      if (!amount || amount <= 0) {
        qtResultToast.textContent = "Iltimos, miqdorni kiriting.";
        qtResultToast.classList.add("err");
        qtResultToast.style.display = "block";
        return;
      }

      if (!recipient) {
        qtResultToast.textContent =
          "Qabul qiluvchi (username, telefon yoki karta) ni kiriting.";
        qtResultToast.classList.add("err");
        qtResultToast.style.display = "block";
        return;
      }

      recalc();
      const net = feeNetAmount.textContent;
      const text = `Demo: ${recipient} foydalanuvchiga taxminan ${net} ${toCode} yuborilgan deb hisoblaymiz.`;
      qtResultToast.textContent = text;
      qtResultToast.style.display = "block";
      qtDemoLine.textContent = text;
    });

    // ======= TELEGRAM WEBAPP PROFILE INTEGRATSIYA =======

    const pfName = document.getElementById("pf_name");
    const pfId = document.getElementById("pf_id");
    const pfUsername = document.getElementById("pf_username");
    const pfChipName = document.getElementById("pf_chip_name");
    const pfAvatar = document.getElementById("pf_avatar");

    function initProfileSheet() {
      let name = "-";
      let id = "-";
      let username = "-";

      try {
        if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe) {
          const u = Telegram.WebApp.initDataUnsafe.user;
          if (u) {
            if (u.first_name || u.last_name) {
              name = [u.first_name, u.last_name].filter(Boolean).join(" ");
            }
            if (u.id) {
              id = String(u.id);
            }
            if (u.username) {
              username = "@" + u.username;
            }
          }
        }
      } catch (e) {
        console.warn("Telegram initDataUnsafe oâ€˜qishda xato:", e);
      }

      pfName.textContent = name;
      pfId.textContent = id;
      pfUsername.textContent = username;

      // chip ustidagi qisqa ism
      pfChipName.textContent = name !== "-" ? name.split(" ")[0] : "Profil";

      // avatar ichidagi 2 ta harf
      let short = "TG";
      if (name && name !== "-") {
        const parts = name.trim().split(/\s+/);
        short =
          (parts[0]?.[0] || "").toUpperCase() +
          (parts[1]?.[0] || "").toUpperCase();
      }
      pfAvatar.textContent = short || "TG";
    }

    // Telegram theme tayyor boâ€˜lganda chaqiramiz
    try {
      if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.ready();
      }
    } catch (e) {
      console.warn("Telegram.WebApp.ready chaqirib boâ€˜lmadi:", e);
    }

    initProfileSheet();
    recalc();

    // ======= PROFILE MODAL OPEN/CLOSE =======

    const profileBg = document.getElementById("profileBg");
    const profileOpen = document.getElementById("profileOpen");
    const profileClose = document.getElementById("profileClose");

    profileOpen.addEventListener("click", () => {
      profileBg.classList.add("show");
    });

    profileClose.addEventListener("click", () => {
      profileBg.classList.remove("show");
    });

    profileBg.addEventListener("click", (e) => {
      if (e.target === profileBg) {
        profileBg.classList.remove("show");
      }
    });
  </script>
</body>
</html>
