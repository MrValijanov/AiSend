<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <title>AiSend Pay · Demo konvertor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Roboto", "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #0f172a 0, #020617 55%, #000 100%);
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      padding: 20px 12px 32px;
    }

    .app {
      width: 100%;
      max-width: 420px;
    }

    .app-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .app-title {
      font-size: 26px;
      font-weight: 800;
      letter-spacing: 0.03em;
    }

    .pill-row {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: #9ca3af;
      background: rgba(15, 23, 42, 0.95);
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      display: inline-block;
      margin-right: 6px;
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.8);
    }

    .pill-beta {
      border-color: rgba(251, 191, 36, 0.5);
      color: #facc15;
    }

    .card {
      border-radius: 26px;
      padding: 18px 18px 20px;
      background: radial-gradient(circle at top left, #0ea5e9 0, #1e293b 40%, #020617 100%);
      box-shadow:
        0 18px 45px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(148, 163, 184, 0.25);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .badge {
      width: 46px;
      height: 46px;
      border-radius: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top left, #22c55e 0, #0ea5e9 40%, #0369a1 100%);
      box-shadow: 0 12px 24px rgba(34, 197, 94, 0.4);
      color: #0b1120;
      font-weight: 800;
      font-size: 22px;
    }

    .card-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .card-title {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .card-subtitle {
      font-size: 12px;
      color: #9ca3af;
    }

    .online-tag {
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(34, 197, 94, 0.6);
      color: #bbf7d0;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.7);
    }

    .online-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.9);
    }

    .section-title {
      margin-top: 6px;
      margin-bottom: 6px;
      font-size: 13px;
      letter-spacing: 0.06em;
      color: #9ca3af;
    }

    .currency-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 12px;
    }

    .currency-card {
      flex: 1;
      padding: 10px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .currency-label {
      font-size: 11px;
      color: #9ca3af;
    }

    .currency-code {
      font-size: 18px;
      font-weight: 700;
    }

    .currency-caption {
      font-size: 11px;
      color: #9ca3af;
    }

    .swap-btn {
      width: 52px;
      height: 52px;
      border-radius: 999px;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #22c55e 0, #0ea5e9 60%, #0369a1 100%);
      box-shadow:
        0 16px 30px rgba(34, 197, 94, 0.4),
        0 0 0 3px rgba(15, 23, 42, 0.9);
      color: #0b1120;
      font-size: 22px;
      cursor: pointer;
    }

    .direction-select-wrapper {
      margin-top: 6px;
      margin-bottom: 10px;
    }

    label {
      font-size: 12px;
      color: #9ca3af;
      display: block;
      margin-bottom: 4px;
    }

    select,
    input[type="text"],
    input[type="number"] {
      width: 100%;
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.95);
      padding: 10px 12px;
      color: #e5e7eb;
      font-size: 14px;
      outline: none;
    }

    select:focus,
    input:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.6);
    }

    .hint {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 4px;
    }

    .mode-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 10px;
      margin-bottom: 14px;
      gap: 10px;
    }

    .mode-left {
      font-size: 11px;
      color: #9ca3af;
      max-width: 65%;
    }

    .toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .toggle-label {
      font-size: 11px;
    }

    .toggle-switch {
      width: 46px;
      height: 24px;
      border-radius: 999px;
      padding: 3px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.8);
      position: relative;
    }

    .toggle-knob {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: #64748b;
      position: absolute;
      top: 3px;
      left: 3px;
      transition: all 0.18s ease-out;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.9);
    }

    .toggle-switch.on {
      border-color: rgba(34, 197, 94, 0.9);
      background: radial-gradient(circle at top, #22c55e 0, #16a34a 45%, #14532d 100%);
    }

    .toggle-switch.on .toggle-knob {
      left: 23px;
      background: #ecfdf5;
    }

    .btn-primary {
      margin-top: 4px;
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 13px 16px;
      background: linear-gradient(to right, #22c55e, #0ea5e9);
      color: #022c22;
      font-weight: 700;
      font-size: 16px;
      letter-spacing: 0.03em;
      cursor: pointer;
      box-shadow:
        0 16px 30px rgba(34, 197, 94, 0.5),
        0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow:
        0 10px 18px rgba(34, 197, 94, 0.45),
        0 0 0 1px rgba(15, 23, 42, 1);
    }

    .result-card {
      margin-top: 12px;
      padding: 14px 14px 12px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.7);
    }

    .result-main {
      font-size: 18px;
      font-weight: 700;
    }

    .result-sub {
      margin-top: 4px;
      font-size: 12px;
      color: #9ca3af;
    }

    .error-text {
      margin-top: 8px;
      font-size: 11px;
      color: #f97373;
      min-height: 14px;
    }

    .profile-card {
      margin-top: 16px;
      padding: 13px 14px;
      border-radius: 18px;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
    }

    .pf-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .pf-item {
      font-size: 12px;
      color: #e5e7eb;
      margin: 2px 0;
    }

    .pf-item span.label {
      color: #9ca3af;
    }

    .pf-empty {
      font-size: 11px;
      color: #9ca3af;
    }

    .footer-text {
      margin-top: 10px;
      font-size: 10px;
      color: #6b7280;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="app-header">
      <div class="app-title">AiSend</div>
    </div>

    <div class="pill-row">
      <div class="pill"><span class="pill-dot"></span>AiSend · Demo konvertor</div>
      <div class="pill pill-beta">Beta build</div>
    </div>

    <div class="card">
      <div class="card-header">
        <div style="display:flex;align-items:center;gap:10px;">
          <div class="badge">A</div>
          <div class="card-title-block">
            <div class="card-title">AiSend Pay</div>
            <div class="card-subtitle">Chegarasiz valyuta almashtiruvi</div>
          </div>
        </div>
        <div class="online-tag" id="online-tag">
          <span class="online-dot"></span>
          Onlayn kurslar
        </div>
      </div>

      <div class="section-title">YO‘NALISH</div>
      <div class="currency-row">
        <div class="currency-card" id="from-card">
          <div class="currency-label">UZS</div>
          <div class="currency-code" id="from-code">UZS</div>
          <div class="currency-caption" id="from-caption">Asosiy balans</div>
        </div>
        <button class="swap-btn" id="swap-btn">⇄</button>
        <div class="currency-card" id="to-card">
          <div class="currency-label">KZT / KGS</div>
          <div class="currency-code" id="to-code">KZT/KGS</div>
          <div class="currency-caption" id="to-caption">Qabul qiluvchi karta</div>
        </div>
      </div>

      <div class="direction-select-wrapper">
        <label for="direction">Yo‘nalishni tanlang</label>
        <select id="direction">
          <option value="UZS_KZT">UZS → KZT</option>
          <option value="UZS_KGS">UZS → KGS</option>
          <option value="KZT_UZS">KZT → UZS</option>
          <option value="KGS_UZS">KGS → UZS</option>
        </select>
      </div>

      <div class="amount-wrapper">
        <label for="amount">Miqdor</label>
        <input id="amount" type="text" inputmode="decimal" placeholder="Miqdor kiriting" />
        <div class="hint" id="rate-hint">1 UZS ≈ demo kurs</div>
      </div>

      <div class="mode-row">
        <div class="mode-left">
          Kurslar onlayn API orqali olinmoqda. Hali rasmiy AiSend serveri ulanmagan.
        </div>
        <div class="toggle" id="mode-toggle">
          <div class="toggle-switch on" id="mode-switch">
            <div class="toggle-knob"></div>
          </div>
          <div class="toggle-label" id="mode-label">
            Onlayn kurslar yoqilgan.
          </div>
        </div>
      </div>

      <button class="btn-primary" id="calc-btn">Hisoblash</button>

      <div class="result-card">
        <div class="result-main" id="result-main">0 UZS ≈ 0 KZT</div>
        <div class="result-sub" id="result-sub">1 UZS ≈ 0.04 KZT (demo kurs)</div>
      </div>

      <div class="error-text" id="error-text"></div>

      <div class="profile-card" id="profile-card">
        <div class="pf-title">Telegram profil</div>
        <div class="pf-empty" id="profile-empty">
          AiSend demo interfeysi. Telegram orqali kirganda bu yerda foydalanuvchi profili ko‘rinadi.
        </div>
        <div id="profile-data" style="display:none;">
          <div class="pf-item">
            <span class="label">ID:</span>
            <span id="pf-id">-</span>
          </div>
          <div class="pf-item">
            <span class="label">Ism:</span>
            <span id="pf-name">-</span>
          </div>
          <div class="pf-item">
            <span class="label">Username:</span>
            <span id="pf-username">-</span>
          </div>
        </div>
      </div>
    </div>

    <div class="footer-text">
      AiSend demo interfeysi. Fikr va takliflar — keyingi bosqich uchun asos bo‘ladi.
    </div>
  </div>
<script>
    const DEMO_RATES = {
      UZS_KZT: 0.04,
      KZT_UZS: 25,
      UZS_KGS: 0.007,
      KGS_UZS: 140
    };

    const directionSelect = document.getElementById("direction");
    const amountInput = document.getElementById("amount");
    const calcBtn = document.getElementById("calc-btn");
    const resultMain = document.getElementById("result-main");
    const resultSub = document.getElementById("result-sub");
    const rateHint = document.getElementById("rate-hint");
    const errorText = document.getElementById("error-text");

    const modeToggle = document.getElementById("mode-toggle");
    const modeSwitch = document.getElementById("mode-switch");
    const modeLabel = document.getElementById("mode-label");
    const onlineTag = document.getElementById("online-tag");

    const swapBtn = document.getElementById("swap-btn");
    const fromCodeEl = document.getElementById("from-code");
    const toCodeEl = document.getElementById("to-code");

    let onlineMode = true;
    let lastOnlineRate = null;

    function getDirectionParts() {
      const [from, to] = directionSelect.value.split("_");
      return { from, to };
    }

    function formatNumber(num) {
      return new Intl.NumberFormat("uz-UZ", {
        maximumFractionDigits: 2,
        minimumFractionDigits: 0
      }).format(num);
    }

    function formatRate(num) {
      return new Intl.NumberFormat("uz-UZ", {
        maximumFractionDigits: 6,
        minimumFractionDigits: 4
      }).format(num);
    }

    async function fetchLiveRate(from, to) {
      const url = `/api/rates?from=${encodeURIComponent(from)}&to=${encodeURIComponent(to)}`;
      const res = await fetch(url);

      if (!res.ok) {
        throw new Error("HTTP error: " + res.status);
      }

      const data = await res.json();

      if (!data.ok || !data.rates || typeof data.rates[to] !== "number") {
        throw new Error("Rate not found");
      }

      return data.rates[to];
    }

    async function recalc() {
      errorText.textContent = "";

      const rawVal = amountInput.value.trim().replace(",", ".");
      const val = parseFloat(rawVal);
      const { from, to } = getDirectionParts();

      if (!rawVal || isNaN(val) || val <= 0) {
        resultMain.textContent = `0 ${from} ≈ 0 ${to}`;
        resultSub.textContent = `1 ${from} ≈ ${formatRate(DEMO_RATES[directionSelect.value] || 0)} ${to} (demo kurs)`;
        errorText.textContent = "Miqdor kiriting.";
        return;
      }

      let rate = DEMO_RATES[directionSelect.value] || 0;

      if (onlineMode) {
        try {
          rate = await fetchLiveRate(from, to);
          lastOnlineRate = rate;
        } catch (err) {
          console.error("Live rate error:", err);
          errorText.textContent =
            "Onlayn kurslarni yuklashda muammo. Hozircha demo kurslar ishlatilmoqda.";
        }
      }

      const result = val * rate;
      resultMain.textContent = `${formatNumber(val)} ${from} ≈ ${formatNumber(result)} ${to}`;

      const baseRate = lastOnlineRate ?? (DEMO_RATES[directionSelect.value] || 0);
      const modeLabelText = lastOnlineRate ? "onlayn API" : "demo kurs";
      resultSub.textContent = `1 ${from} ≈ ${formatRate(baseRate)} ${to} (${modeLabelText})`;
      rateHint.textContent = `1 ${from} ≈ ${modeLabelText}`;
    }

    calcBtn.addEventListener("click", () => {
      recalc();
    });

    amountInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        recalc();
      }
    });

    directionSelect.addEventListener("change", () => {
      const { from, to } = getDirectionParts();
      fromCodeEl.textContent = from;
      toCodeEl.textContent = to;
      recalc();
    });

    modeToggle.addEventListener("click", () => {
      onlineMode = !onlineMode;

      if (onlineMode) {
        modeSwitch.classList.add("on");
        modeLabel.textContent = "Onlayn kurslar yoqilgan.";
        onlineTag.style.opacity = "1";
      } else {
        modeSwitch.classList.remove("on");
        modeLabel.textContent = "Onlayn kurslar o‘chirilgan (demo).";
        onlineTag.style.opacity = "0.5";
      }

      recalc();
    });

    swapBtn.addEventListener("click", () => {
      const value = directionSelect.value;
      let newValue = value;

      if (value === "UZS_KZT") newValue = "KZT_UZS";
      else if (value === "KZT_UZS") newValue = "UZS_KZT";
      else if (value === "UZS_KGS") newValue = "KGS_UZS";
      else if (value === "KGS_UZS") newValue = "UZS_KGS";

      directionSelect.value = newValue;
      const { from, to } = getDirectionParts();
      fromCodeEl.textContent = from;
      toCodeEl.textContent = to;
      recalc();
    });
// ===== PROFILE INIT FROM URL =====
    (function initProfile() {
      const params = new URLSearchParams(window.location.search);
      const tgId = params.get("tg_id");
      const tgName = params.get("tg_name");
      const tgUsername = params.get("tg_username");

      const emptyEl = document.getElementById("profile-empty");
      const dataWrap = document.getElementById("profile-data");
      const idEl = document.getElementById("pf-id");
      const nameEl = document.getElementById("pf-name");
      const usernameEl = document.getElementById("pf-username");

      if (tgId || tgName || tgUsername) {
        emptyEl.style.display = "none";
        dataWrap.style.display = "block";

        idEl.textContent = tgId || "-";
        nameEl.textContent = tgName || "-";
        usernameEl.textContent = tgUsername ? ("@" + tgUsername) : "-";
      } else {
        emptyEl.style.display = "block";
        dataWrap.style.display = "none";
      }
    })();

    // Boshlang‘ich hisob
    recalc();
  </script>
</body>
</html>
