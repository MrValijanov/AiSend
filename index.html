<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AiSend Pay · Demo konvertor</title>
  <style>
    :root {
      --bg: #020615;
      --card: #050b1f;
      --card-soft: #081226;
      --accent-from: #10c66f;
      --accent-to: #08a6ff;
      --accent-soft: rgba(16, 198, 111, 0.18);
      --border-soft: #1a2740;
      --text-main: #f9fbff;
      --text-soft: #9aa6c2;
      --text-muted: #6b7690;
      --danger: #ff4e5c;
      --success: #24e08a;
      --chip-bg: rgba(12, 180, 255, 0.08);
      --chip-border: rgba(12, 180, 255, 0.35);
      --radius-xl: 24px;
      --radius-lg: 18px;
      --radius-pill: 999px;
      --shadow-soft: 0 24px 60px rgba(0, 0, 0, 0.75);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Roboto", sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #071633 0, #020615 55%, #000 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 24px 12px 32px;
    }

    .app {
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
    }

    /* HEADER */
    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
    }

    .brand-title {
      font-size: 26px;
      font-weight: 700;
      letter-spacing: 0.03em;
    }

.profile-card {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  margin: 0 0 16px 0;
  border-radius: 16px;
  background: linear-gradient(120deg, #101827, #050816);
  border: 1px solid rgba(255, 255, 255, 0.06);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45);
}

.profile-avatar {
  width: 42px;
  height: 42px;
  border-radius: 999px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: radial-gradient(circle at 30% 0, #34d399, #10b981, #047857);
  box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.9);
}

.profile-avatar span {
  font-weight: 700;
  font-size: 18px;
  color: #0b1120;
}

.profile-info {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.profile-name {
  font-size: 15px;
  font-weight: 600;
  color: #e5e7eb;
}

.profile-username {
  font-size: 13px;
  color: #9ca3af;
}

.profile-id {
  font-size: 11px;
  color: #6b7280;
}

.hidden {
  display: none;
}

    .tag-row {
      display: flex;
      gap: 8px;
      margin-top: 6px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .chip {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--chip-border);
      background: var(--chip-bg);
      backdrop-filter: blur(12px);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #11d37f;
      box-shadow: 0 0 12px rgba(17, 211, 127, 0.9);
    }

    .beta-chip {
      border-color: rgba(255, 255, 255, 0.22);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text-muted);
    }

    /* MAIN CARD */
    .pay-card {
      background: radial-gradient(circle at top left, #0b2540, #050b1f 55%, #020615 100%);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 22px;
      border: 1px solid rgba(87, 112, 170, 0.52);
      position: relative;
      overflow: hidden;
    }

    .pay-card::before {
      content: "";
      position: absolute;
      inset: -120px;
      background: radial-gradient(circle at 20% 0%, rgba(8, 190, 255, 0.22), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }

    .pay-card-inner {
      position: relative;
      z-index: 1;
    }

    .pay-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }

    .pay-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .pay-logo {
      width: 44px;
      height: 44px;
      border-radius: 16px;
      background: radial-gradient(circle at 30% 0%, #4bffe2, #0b9dff 55%, #0643ff 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.8);
      font-weight: 800;
      font-size: 20px;
      color: #03101b;
    }

    .pay-title-text {
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .pay-name {
      font-size: 18px;
      font-weight: 700;
    }

    .pay-sub {
      font-size: 12px;
      color: var(--text-soft);
    }

    .live-status {
      padding: 5px 12px;
      border-radius: 999px;
      background: rgba(5, 255, 167, 0.1);
      border: 1px solid rgba(5, 255, 167, 0.35);
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--success);
      font-weight: 500;
    }

    .live-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
      box-shadow: 0 0 14px rgba(36, 224, 138, 0.85);
    }

    /* CURRENCY CARDS */
    .currency-row {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 10px;
      margin-bottom: 18px;
    }

    .cur-card {
      background: linear-gradient(160deg, rgba(9, 21, 53, 0.96), rgba(7, 15, 35, 0.96));
      border-radius: var(--radius-lg);
      border: 1px solid rgba(140, 175, 255, 0.38);
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .cur-label {
      font-size: 11px;
      color: var(--text-soft);
    }

    .cur-main-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .cur-code-pill {
      min-width: 46px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(3, 10, 40, 0.95);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 13px;
      border: 1px solid rgba(154, 180, 255, 0.55);
    }

    .cur-name {
      font-size: 11px;
      color: var(--text-soft);
    }

    .swap-pill {
      width: 42px;
      height: 42px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0%, #48ffb6, #08a6ff 75%);
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid rgba(160, 232, 255, 0.7);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.85);
      cursor: pointer;
    }

    .swap-pill span {
      font-size: 20px;
      filter: drop-shadow(0 0 10px rgba(0, 0, 0, 0.8));
    }

    /* DIRECTION SELECT */
    .section-label {
      font-size: 12px;
      color: var(--text-soft);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .direction-select {
      width: 100%;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(159, 190, 255, 0.6);
      padding: 10px 14px;
      background: radial-gradient(circle at 0 50%, rgba(14, 197, 120, 0.12), rgba(4, 17, 48, 0.95));
      color: var(--text-main);
      font-size: 13px;
      outline: none;
      appearance: none;
      position: relative;
    }

    .direction-wrapper {
      position: relative;
      margin-bottom: 14px;
    }

    .direction-wrapper::after {
      content: "▾";
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 11px;
      color: var(--text-soft);
      pointer-events: none;
    }

    /* AMOUNT */
    .amount-label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
      font-size: 12px;
      color: var(--text-soft);
    }

    .demo-rate-hint {
      font-size: 11px;
      color: var(--text-muted);
    }

    .amount-input {
      width: 100%;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(133, 168, 255, 0.65);
      padding: 10px 14px;
      background: rgba(5, 11, 30, 0.95);
      color: var(--text-main);
      font-size: 15px;
      outline: none;
    }

    .amount-input::placeholder {
      color: rgba(135, 151, 190, 0.7);
    }

    .help-text {
      margin-top: 5px;
      font-size: 11px;
      color: var(--text-soft);
      line-height: 1.4;
    }

    .help-text strong {
      color: var(--success);
    }

    /* ONLINE TOGGLE */
    .mode-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 12px;
      margin-bottom: 16px;
      gap: 10px;
    }

    .toggle-group {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text-soft);
    }

    .toggle-switch {
      width: 38px;
      height: 22px;
      border-radius: 999px;
      background: rgba(14, 27, 60, 0.96);
      border: 1px solid rgba(129, 167, 255, 0.6);
      position: relative;
      cursor: pointer;
      flex-shrink: 0;
    }

    .toggle-switch input {
      display: none;
    }

    .toggle-knob {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 17px;
      height: 17px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 0%, #58ffd2, #0fb2ff);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.8);
      transition: transform 0.18s ease-out;
    }

    .toggle-switch input:checked + .toggle-knob {
      transform: translateX(14px);
    }

    .mode-hint {
      font-size: 11px;
      color: var(--success);
      text-align: right;
    }

    /* BUTTON */
    .btn-primary {
      width: 100%;
      margin-top: 4px;
      border-radius: var(--radius-pill);
      border: none;
      padding: 12px 14px;
      background: linear-gradient(90deg, var(--accent-from), var(--accent-to));
      color: #04121f;
      font-size: 15px;
      font-weight: 700;
      letter-spacing: 0.03em;
      text-transform: capitalize;
      box-shadow: 0 16px 40px rgba(8, 190, 255, 0.55);
      cursor: pointer;
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 10px 24px rgba(8, 190, 255, 0.5);
    }

    /* RESULT */
    .result-card {
      margin-top: 14px;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(151, 183, 255, 0.55);
      background: radial-gradient(circle at 0 0, rgba(21, 219, 143, 0.12), rgba(3, 11, 30, 0.96));
      padding: 12px 14px;
    }

    .result-main {
      font-size: 17px;
      font-weight: 700;
      margin-bottom: 2px;
    }

    .result-sub {
      font-size: 11px;
      color: var(--text-soft);
    }

    .error-text {
      margin-top: 6px;
      font-size: 11px;
      color: var(--danger);
      min-height: 13px;
    }

    /* PROFILE BOX */
    .profile-box {
      margin-top: 18px;
      border-radius: var(--radius-lg);
      border: 1px dashed rgba(126, 148, 210, 0.7);
      padding: 10px 12px;
      background: radial-gradient(circle at 0 0, rgba(12, 180, 255, 0.12), rgba(2, 6, 21, 0.96));
      font-size: 11px;
      color: var(--text-soft);
    }

    .profile {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .pf-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 4px;
    }

    .pf-item {
      display: flex;
      gap: 4px;
    }

    .pf-item span {
      color: var(--text-muted);
    }

    /* FOOTER */
    .footer {
      margin-top: 14px;
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
      line-height: 1.4;
    }

    .footer strong {
      color: var(--text-soft);
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div>
        <div class="brand-title">AiSend</div>
        <div class="tag-row">
          <span class="chip">
            <span class="chip-dot"></span>
        
  <!-- PROFIL KARTASI -->
<div id="profile-card" class="profile-card hidden">
  <div class="profile-avatar">
    <span id="profile-avatar-letter">A</span>
  </div>
  <div class="profile-info">
    <div id="profile-name" class="profile-name">AiSend foydalanuvchisi</div>
    <div id="profile-username" class="profile-username">@username</div>
    <div id="profile-id" class="profile-id">ID: 0</div>
  </div>
</div>

  AiSend · Demo konvertor
          </span>
          <span class="chip beta-chip">Beta build</span>
        </div>
      </div>
    </header>

    <main class="pay-card">
      <div class="pay-card-inner">
        <div class="pay-header">
          <div class="pay-left">
            <div class="pay-logo">A</div>
            <div class="pay-title-text">
              <div class="pay-name">AiSend Pay</div>
              <div class="pay-sub">Chegarasiz valyuta almashinuv</div>
            </div>
          </div>
          <div class="live-status">
            <span class="live-dot"></span>
            Onlayn kurslar
          </div>
        </div>

        <div class="currency-row">
          <div class="cur-card">
            <div class="cur-label">UZS</div>
            <div class="cur-main-row">
              <div class="cur-code-pill">UZS</div>
              <div class="cur-name">Asosiy balans</div>
            </div>
          </div>

          <button id="swapBtn" class="swap-pill" type="button">
            <span>⇄</span>
          </button>

          <div class="cur-card">
            <div class="cur-label">KZT / KGS</div>
            <div class="cur-main-row">
              <div class="cur-code-pill">KZT/KGS</div>
              <div class="cur-name">Qabul qiluvchi karta</div>
            </div>
          </div>
        </div>

        <div class="section-label">Yo‘nalishni tanlang</div>
        <div class="direction-wrapper">
          <select id="directionSelect" class="direction-select">
            <option value="UZS_KZT">UZS → KZT</option>
            <option value="KZT_UZS">KZT → UZS</option>
            <option value="UZS_KGS">UZS → KGS</option>
            <option value="KGS_UZS">KGS → UZS</option>
          </select>
        </div>

        <div class="amount-label-row">
          <span>MiQDOR</span>
          <span class="demo-rate-hint"><span id="baseRateHint">1 UZS ≈ demo kurs</span></span>
        </div>

        <input
          id="amountInput"
          class="amount-input"
          type="text"
          inputmode="decimal"
          placeholder="Miqdor kiriting"
        />

        <p class="help-text">
          Kurslar <strong>onlayn API</strong> orqali olinmoqda. Hali rasmiy AiSend
          serveri ulanmagan.
        </p>

        <div class="mode-row">
          <label class="toggle-group">
            <span>Onlayn kurslar yoqilgan.</span>
            <label class="toggle-switch">
              <input id="onlineToggle" type="checkbox" checked />
              <span class="toggle-knob"></span>
            </label>
          </label>
          <div id="modeHint" class="mode-hint">
            Onlayn kurslar yoqilgan. O‘chirsangiz, demo kurslar ishlatiladi.
          </div>
        </div>

        <button id="calcBtn" class="btn-primary" type="button">
          Hisoblash
        </button>

        <div class="result-card">
          <div id="resultMain" class="result-main">0 UZS ≈ 0 KZT</div>
          <div id="resultSub" class="result-sub">
            1 UZS ≈ 0.04 KZT (demo kurs)
          </div>
        </div>

        <div id="errorText" class="error-text"></div>

        <div id="profileBox" class="profile-box">
          AiSend demo interfeysi. Telegram orqali kirganda bu yerda foydalanuvchi
          profili ko‘rinadi.
        </div>
      </div>
    </main>

    <footer class="footer">
      AiSend <strong>demo</strong> interfeysi. Fikr va takliflar — keyingi bosqich
      uchun asos bo‘ladi.
    </footer>
  </div>
<script>
    // ==== Statik demo kurslar (fallback) ====
    const DEMO_RATES = {
      UZS_KZT: 0.04,
      KZT_UZS: 25,
      UZS_KGS: 0.007,
      KGS_UZS: 140,
    };

    const directionSelect = document.getElementById("directionSelect");
    const amountInput = document.getElementById("amountInput");
    const resultMain = document.getElementById("resultMain");
    const resultSub = document.getElementById("resultSub");
    const errorText = document.getElementById("errorText");
    const modeHint = document.getElementById("modeHint");
    const baseRateHint = document.getElementById("baseRateHint");
    const calcBtn = document.getElementById("calcBtn");
    const onlineToggle = document.getElementById("onlineToggle");
    const swapBtn = document.getElementById("swapBtn");

    let lastOnlineRate = null;

    function getDirectionParts() {
      const val = directionSelect.value; // masalan: "UZS_KZT"
      const [from, to] = val.split("_");
      return { from, to };
    }

    function formatNumber(num) {
      return new Intl.NumberFormat("uz-UZ", {
        maximumFractionDigits: 2,
        minimumFractionDigits: 0,
      }).format(num);
    }

    function formatRate(num) {
      return new Intl.NumberFormat("uz-UZ", {
        maximumFractionDigits: 6,
        minimumFractionDigits: 4,
      }).format(num);
    }

    async function fetchLiveRate(from, to) {
      const params = new URLSearchParams({ from, to });
      const url = `/api/rates?${params.toString()}`;

      const res = await fetch(url);
      if (!res.ok) {
        throw new Error("HTTP error");
      }

      const data = await res.json();

      // Vercel API: { success: true, base, rates: {KZT: ...} }
      if (data.success === false || !data.rates) {
        throw new Error(data.error || "Rate not found");
      }

      const rate = data.rates[to];
      if (typeof rate !== "number") {
        throw new Error("Rate not found");
      }
      return rate;
    }

    async function recalc() {
      errorText.textContent = "";

      const rawVal = (amountInput.value || "").trim();
      const normalized = rawVal.replace(",", ".");
      const val = parseFloat(normalized);
      const { from, to } = getDirectionParts();

      if (!rawVal || isNaN(val) || val <= 0) {
        resultMain.textContent = `0 ${from} ≈ 0 ${to}`;
        resultSub.textContent = `1 ${from} ≈ ${DEMO_RATES[directionSelect.value]} ${to} (demo kurs)`;
        baseRateHint.textContent = `1 ${from} ≈ demo kurs`;
        errorText.textContent = "Miqdor kiriting.";
        return;
      }

      let rate = DEMO_RATES[directionSelect.value];
      const onlineMode = onlineToggle.checked;

      if (onlineMode) {
        try {
          rate = await fetchLiveRate(from, to);
          lastOnlineRate = rate;
        } catch (err) {
          console.error("Live rate error:", err);
          errorText.textContent =
            "Onlayn kurslarni yuklashda muammo. Hozircha demo kurslardan foydalanilmoqda.";
        }
      }

      const result = val * rate;
      resultMain.textContent = `${formatNumber(val)} ${from} ≈ ${formatNumber(
        result
      )} ${to}`;

      const baseRate = lastOnlineRate ?? DEMO_RATES[directionSelect.value];
      const modeLabel = lastOnlineRate ? "onlayn API" : "demo kurs";

      resultSub.textContent = `1 ${from} ≈ ${formatRate(
        baseRate
      )} ${to} (${modeLabel})`;
      baseRateHint.textContent = `1 ${from} ≈ ${modeLabel}`;
    }

    calcBtn.addEventListener("click", recalc);
    amountInput.addEventListener("keyup", (e) => {
      if (e.key === "Enter") recalc();
    });

    onlineToggle.addEventListener("change", () => {
      if (onlineToggle.checked) {
        modeHint.textContent =
          "Onlayn kurslar yoqilgan. O‘chirsangiz, demo kurslar ishlatiladi.";
      } else {
        modeHint.textContent = "Demo kurslar ishlatilmoqda.";
        lastOnlineRate = null;
      }
      recalc();
    });

    swapBtn.addEventListener("click", () => {
      const current = directionSelect.value;
      let next = current;
      if (current === "UZS_KZT") next = "KZT_UZS";
      else if (current === "KZT_UZS") next = "UZS_KZT";
      else if (current === "UZS_KGS") next = "KGS_UZS";
      else if (current === "KGS_UZS") next = "UZS_KGS";
      directionSelect.value = next;
      recalc();
    });

    directionSelect.addEventListener("change", recalc);

<script>
  (function initProfile() {
    const params = new URLSearchParams(window.location.search);

    const tgId = params.get("tg_id");
    const tgName = params.get("tg_name");
    const tgUsername = params.get("tg_username");

    const card = document.getElementById("profile-card");
    const nameEl = document.getElementById("profile-name");
    const userEl = document.getElementById("profile-username");
    const idEl = document.getElementById("profile-id");
    const avatarLetterEl = document.getElementById("profile-avatar-letter");

    if (!card || !nameEl || !avatarLetterEl) return;

    // Agar parametrlar bo‘lmasa – kartani yashiramiz
    if (!tgId && !tgName && !tgUsername) {
      card.classList.add("hidden");
      return;
    }

    const cleanName = (tgName || "").trim() || "AiSend foydalanuvchisi";
    nameEl.textContent = cleanName;

    if (tgUsername) {
      userEl.textContent = "@" + tgUsername;
      userEl.style.display = "block";
    } else {
      userEl.style.display = "none";
    }

    if (tgId) {
      idEl.textContent = "ID: " + tgId;
      idEl.style.display = "block";
    } else {
      idEl.style.display = "none";
    }

    avatarLetterEl.textContent = cleanName[0].toUpperCase();
    card.classList.remove("hidden");
  })();
</script>
</body>
</html>
