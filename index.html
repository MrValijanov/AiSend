<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <title>AiSend Pay · Demo konvertor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-main: #050816;
      --bg-card: #111827;
      --bg-card-soft: #020617;
      --accent: #22c55e;
      --accent-soft: #22c55e33;
      --accent-2: #0ea5e9;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --danger: #f97373;
      --radius-xl: 22px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Roboto", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #1e293b 0, #020617 45%, #000 100%);
      min-height: 100vh;
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 20px 10px 26px;
    }

    .shell {
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
    }

    .app-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .app-title {
      font-size: 24px;
      font-weight: 700;
    }

    .pill-row {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 12px;
      background: #020617;
      color: var(--text-muted);
      border: 1px solid #1f2937;
    }

    .pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px #22c55e33;
    }

    .pill-beta {
      background: #111827;
      border-color: #1f2937;
    }

    .card {
      background: linear-gradient(145deg, #020617, #020617, #020617);
      border-radius: var(--radius-xl);
      padding: 18px 16px 18px;
      box-shadow:
        0 22px 45px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(15, 23, 42, 0.9);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 10% -10%, #22c55e33 0, transparent 52%),
        radial-gradient(circle at 110% 10%, #0ea5e933 0, transparent 52%);
      opacity: 0.5;
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .product {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .product-icon {
      width: 40px;
      height: 40px;
      border-radius: 14px;
      background: conic-gradient(from 200deg, #22c55e, #0ea5e9, #22c55e);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #022c22;
      font-weight: 800;
      font-size: 20px;
      box-shadow:
        0 0 0 1px #022c22,
        0 18px 35px rgba(22, 163, 74, 0.6);
    }

    .product-text-title {
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .product-text-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    .mode-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid #1f2937;
      font-size: 12px;
      color: var(--text-muted);
    }

    .mode-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    .mode-pill strong {
      color: #bbf7d0;
      font-weight: 600;
    }

    .field-group-label {
      font-size: 11px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-top: 12px;
      margin-bottom: 6px;
    }

    .pair-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      align-items: center;
    }

    .pair-card {
      background: #020617;
      border-radius: 18px;
      padding: 10px 12px;
      border: 1px solid #1f2937;
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.6);
    }

    .pair-label {
      font-size: 10px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .pair-main {
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .pair-code-pill {
      font-size: 12px;
      font-weight: 700;
      padding: 3px 9px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #1f2937;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .pair-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    .swap-pill {
      width: 40px;
      height: 40px;
      border-radius: 22px;
      background: radial-gradient(circle at 30% 20%, #22c55e, #0ea5e9);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 18px 35px rgba(16, 185, 129, 0.75);
    }

    .swap-pill span {
      font-size: 20px;
      filter: drop-shadow(0 4px 6px rgba(15, 23, 42, 0.8));
    }

    .direction-select-wrapper {
      margin-top: 16px;
      position: relative;
    }

    .field-label-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .field-label-row span:last-child {
      color: #a5b4fc;
    }

    .select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid #1f2937;
      background: #020617;
      color: var(--text-main);
      font-size: 14px;
      outline: none;
      appearance: none;
    }

    .select:focus {
      border-color: var(--accent-2);
      box-shadow: 0 0 0 1px #0ea5e966;
    }

    .select-arrow {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(4px);
      font-size: 16px;
      pointer-events: none;
      color: #6b7280;
    }

    .amount-wrapper {
      margin-top: 14px;
    }

    .input {
      width: 100%;
      padding: 11px 12px;
      border-radius: 16px;
      border: 1px solid #1f2937;
      background: #020617;
      color: var(--text-main);
      font-size: 15px;
      outline: none;
    }

    .input::placeholder {
      color: #4b5563;
    }

    .input:focus {
      border-color: var(--accent-2);
      box-shadow: 0 0 0 1px #0ea5e966;
    }

    .hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 6px;
      line-height: 1.5;
    }

    .hint strong {
      color: #4ade80;
      font-weight: 500;
    }

    .btn-primary {
      margin-top: 18px;
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 12px 18px;
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.02em;
      background: linear-gradient(90deg, #22c55e, #0ea5e9);
      color: #022c22;
      box-shadow:
        0 18px 40px rgba(16, 185, 129, 0.7),
        0 0 0 1px rgba(15, 23, 42, 0.9);
      cursor: pointer;
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow:
        0 12px 24px rgba(16, 185, 129, 0.6),
        0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .result-card {
      margin-top: 14px;
      padding: 10px 12px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.9);
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .result-main {
      font-size: 17px;
      font-weight: 600;
    }

    .result-sub {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .error {
      margin-top: 8px;
      font-size: 11px;
      color: var(--danger);
    }

    .footer {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
      line-height: 1.5;
    }

    .footer strong {
      color: #a5b4fc;
      font-weight: 500;
    }

    .mode-toggle-row {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .mode-toggle-row label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .toggle {
      width: 30px;
      height: 16px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #1f2937;
      padding: 2px;
      position: relative;
      box-sizing: border-box;
    }

    .toggle-knob {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: #6b7280;
      transition: transform 0.18s ease, background 0.18s ease;
    }

    .toggle.on {
      border-color: var(--accent);
      background: #022c22;
    }

    .toggle.on .toggle-knob {
      transform: translateX(12px);
      background: #22c55e;
    }
  </style>
</head>
<body>
  <div class="shell">
    <header class="app-header">
      <div class="app-title">AiSend</div>
    </header>

    <div class="pill-row">
      <div class="pill">
        <span class="pill-dot"></span>
        AiSend · Demo konvertor
      </div>
      <div class="pill pill-beta">
        Beta build
      </div>
    </div>

    <main class="card">
      <div class="card-inner">
        <div class="card-header">
          <div class="product">
            <div class="product-icon">A</div>
            <div>
              <div class="product-text-title">AiSend Pay</div>
              <div class="product-text-sub">Chegarasiz valyuta almashinuvi</div>
            </div>
          </div>
          <div class="mode-pill" id="mode-pill">
            <span class="mode-dot"></span>
            <span><strong>Onlayn</strong> kurslar</span>
          </div>
        </div>

        <div class="field-group-label">Yo‘nalish</div>
        <div class="pair-row">
          <div class="pair-card">
            <div class="pair-label">UZS</div>
            <div class="pair-main">
              <span class="pair-code-pill">UZS</span>
              <span class="pair-sub">Asosiy balans</span>
            </div>
          </div>
          <div class="swap-pill" id="swap-btn">
            <span>⇄</span>
          </div>
          <div class="pair-card">
            <div class="pair-label">KZT / KGS</div>
            <div class="pair-main">
              <span class="pair-code-pill">KZT/KGS</span>
              <span class="pair-sub">Qabul qiluvchi karta</span>
            </div>
          </div>
        </div>

        <div class="direction-select-wrapper">
          <div class="field-label-row">
            <span>Yo‘nalishni tanlang</span>
            <span id="direction-label">UZS → KZT</span>
          </div>
          <select id="direction" class="select">
            <option value="UZS_KZT">UZS → KZT</option>
            <option value="KZT_UZS">KZT → UZS</option>
            <option value="UZS_KGS">UZS → KGS</option>
            <option value="KGS_UZS">KGS → UZS</option>
          </select>
          <span class="select-arrow">▾</span>
        </div>

        <div class="amount-wrapper">
          <div class="field-label-row">
            <span>Miqdor</span>
            <span id="pair-label">1 UZS ≈ demo kurs</span>
          </div>
          <input
            id="amount"
            type="number"
            inputmode="decimal"
            class="input"
            placeholder="Miqdor kiriting"
          />
          <div class="hint" id="mode-hint">
            Kurslar <strong>onlayn API</strong> orqali olinmoqda. Hali rasmiy AiSend serveri ulanmagan.
          </div>
        </div>

        <div class="mode-toggle-row">
          <label>
            <div class="toggle on" id="mode-toggle">
              <div class="toggle-knob"></div>
            </div>
            <span>Onlayn kurslar yoqilgan. O‘chirsangiz, demo kurslar ishlatiladi.</span>
          </label>
        </div>

        <button class="btn-primary" id="calc-btn">Hisoblash</button>

        <div class="result-card">
          <div class="result-main" id="result-main">0 UZS ≈ 0 KZT</div>
          <div class="result-sub" id="result-sub">
            1 UZS ≈ 0.0400 KZT (demo kurs)
          </div>
        </div>

        <div class="error" id="error-text"></div>
      </div>
    </main>

    <footer class="footer">
      AiSend <strong>demo</strong> interfeysi. Fikr va takliflar — keyingi bosqich uchun asos bo‘ladi.
    </footer>
  </div>

  <script>
    // Demo kurslar – offline rejim uchun
    const DEMO_RATES = {
      UZS_KZT: 0.04,
      KZT_UZS: 25,
      UZS_KGS: 0.007,
      KGS_UZS: 140,
    };

    const PAIRS = {
      UZS_KZT: { from: "UZS", to: "KZT" },
      KZT_UZS: { from: "KZT", to: "UZS" },
      UZS_KGS: { from: "UZS", to: "KGS" },
      KGS_UZS: { from: "KGS", to: "UZS" },
    };

    const directionEl = document.getElementById("direction");
    const directionLabelEl = document.getElementById("direction-label");
    const amountEl = document.getElementById("amount");
    const resultMainEl = document.getElementById("result-main");
    const resultSubEl = document.getElementById("result-sub");
    const errorTextEl = document.getElementById("error-text");
    const pairLabelEl = document.getElementById("pair-label");
    const modeHintEl = document.getElementById("mode-hint");
    const calcBtn = document.getElementById("calc-btn");
    const swapBtn = document.getElementById("swap-btn");
    const modeToggleEl = document.getElementById("mode-toggle");
    const modePillEl = document.getElementById("mode-pill");

    let onlineMode = true;

    function formatNumber(num) {
      return new Intl.NumberFormat("ru-RU", {
        maximumFractionDigits: 2,
      }).format(num);
    }

    function getCurrentPair() {
      const key = directionEl.value;
      return { key, ...PAIRS[key] };
    }

    function updateLabels() {
      const { key, from, to } = getCurrentPair();
      directionLabelEl.textContent = directionEl.options[directionEl.selectedIndex].text;
      pairLabelEl.textContent = `1 ${from} ≈ demo kurs`;
      const demoRate = DEMO_RATES[key];
      resultMainEl.textContent = `0 ${from} ≈ 0 ${to}`;
      resultSubEl.textContent = `1 ${from} ≈ ${demoRate} ${to} (demo kurs)`;
    }

    // Onlayn kurslarni AiSend backendidan olish
    async function fetchLiveRate(from, to) {
      const url = `https://ai-send.vercel.app/api/rates?from=${from}&to=${to}`;
      const res = await fetch(url);
      const data = await res.json();

      if (!data.ok || !data.rates) {
        throw new Error("API error");
      }

      const rate = data.rates[to];
      if (typeof rate !== "number") {
        throw new Error("Rate not found");
      }

      return rate;
    }

    async function recalc() {
      errorTextEl.textContent = "";
      const { key, from, to } = getCurrentPair();
      const rawVal = amountEl.value;
      const val = parseFloat(rawVal || "0");

      if (!val || val <= 0) {
        resultMainEl.textContent = "0 " + from + " ≈ 0 " + to;
        resultSubEl.textContent = `Miqdor kiriting.`;
        return;
      }

      let rate = DEMO_RATES[key];
      let usedDemo = true;

      if (onlineMode) {
        try {
          const liveRate = await fetchLiveRate(from, to);
          if (typeof liveRate === "number" && liveRate > 0) {
            rate = liveRate;
            usedDemo = false;
          }
        } catch (err) {
          console.log("Live rate error:", err);
          errorTextEl.textContent =
            "Kurslarni yuklashda muammo. Hozircha demo kurslardan foydalanilmoqda.";
        }
      }

      const result = val * rate;
      resultMainEl.textContent = `${formatNumber(val)} ${from} ≈ ${formatNumber(
        result
      )} ${to}`;
      resultSubEl.textContent = usedDemo
        ? `1 ${from} ≈ ${rate} ${to} (demo kurs)`
        : `1 ${from} ≈ ${rate.toFixed(6)} ${to} (onlayn API)`;
    }

    // Toggle online/demo
    function setMode(isOnline) {
      onlineMode = isOnline;
      if (onlineMode) {
        modeToggleEl.classList.add("on");
        modeHintEl.innerHTML =
          'Kurslar <strong>onlayn API</strong> orqali olinmoqda. Hali rasmiy AiSend serveri ulanmagan.';
        modePillEl.innerHTML =
          '<span class="mode-dot"></span><span><strong>Onlayn</strong> kurslar</span>';
      } else {
        modeToggleEl.classList.remove("on");
        modeHintEl.innerHTML =
          "Onlayn API o‘chirildi. Hozircha faqat demo kurslar ishlatilmoqda.";
        modePillEl.innerHTML =
          '<span class="mode-dot" style="background:#6b7280; box-shadow:none;"></span><span><strong>Demo</strong> kurslar</span>';
      }
    }

    modeToggleEl.addEventListener("click", () => {
      setMode(!onlineMode);
    });

    directionEl.addEventListener("change", () => {
      updateLabels();
      recalc();
    });

    amountEl.addEventListener("input", () => {
      recalc();
    });

    calcBtn.addEventListener("click", () => {
      recalc();
    });

    swapBtn.addEventListener("click", () => {
      const current = directionEl.value;
      if (current === "UZS_KZT") directionEl.value = "KZT_UZS";
      else if (current === "KZT_UZS") directionEl.value = "UZS_KZT";
      else if (current === "UZS_KGS") directionEl.value = "KGS_UZS";
      else if (current === "KGS_UZS") directionEl.value = "UZS_KGS";
      updateLabels();
      recalc();
    });

    // Dastlabki holat
    setMode(true);
    updateLabels();
  </script>
</body>
</html>
