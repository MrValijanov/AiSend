<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <title>AiSend ¬∑ Super balance (demo)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #020a03;
      --card: #04240f;
      --card-soft: #073417;
      --accent: #35f46a;
      --accent-soft: #1a8f3f;
      --text-main: #f9fff6;
      --text-soft: #cde5cf;
      --danger: #ff4a4a;
      --border-soft: rgba(255,255,255,0.04);
      --radius-xl: 24px;
      --radius-lg: 18px;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 40px rgba(0,0,0,0.5);
      --transition-fast: .18s ease-out;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top, #06381b 0, #020a03 55%);
      color: var(--text-main);
    }
    .app-root {
      min-height: 100vh;
      max-width: 480px;
      margin: 0 auto;
      padding: 12px 12px 24px;
    }
    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 4px 4px 10px;
    }
    .app-header-title {
      font-size: 22px;
      font-weight: 700;
    }
    .app-header-sub {
      font-size: 12px;
      color: var(--text-soft);
    }
    .header-left span {
      display: block;
    }
    .header-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .profile-pill {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 4px 10px 4px 4px;
      border-radius: var(--radius-pill);
      background: rgba(4, 36, 15, 0.9);
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: var(--shadow-soft);
    }
    .profile-avatar {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: radial-gradient(circle at 20% 0, #9dff7a, #18b846);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      font-size:14px;
      color:#06200e;
    }
    .profile-labels {
      display:flex;
      flex-direction:column;
      line-height:1.1;
    }
    .profile-name {
      font-size: 13px;
      font-weight: 600;
    }
    .profile-handle {
      font-size: 11px;
      color: var(--text-soft);
    }
    .pill-small {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.06);
    }

    /* Ekranlar */
    .screen {
      display: none;
      animation: fadeIn .18s ease-out;
    }
    .screen.active { display: block; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Katta karta (Super balance) */
    .super-card {
      background: radial-gradient(circle at 0 0, #0cc14f 0, #0a3b1f 40%, #021109 100%);
      border-radius: 32px;
      padding: 18px 18px 14px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
      margin-bottom: 14px;
    }
    .super-top {
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:8px;
    }
    .super-title {
      font-size:18px;
      font-weight:600;
      letter-spacing:.02em;
    }
    .super-tagline {
      font-size:11px;
      color:rgba(0,0,0,0.65);
      margin-top:2px;
    }
    .asset-toggle {
      padding:5px 12px;
      border-radius: var(--radius-pill);
      border:1px solid rgba(0,0,0,0.18);
      background:rgba(0,0,0,0.12);
      font-size:11px;
      display:flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
    }
    .asset-toggle span.arrow { font-size: 10px; }

    .super-amount-row {
      display:flex;
      align-items:flex-end;
      gap:4px;
      margin-bottom:8px;
    }
    .super-amount-main {
      font-size:32px;
      font-weight:800;
      letter-spacing:.04em;
    }
    .super-currency {
      font-size:20px;
      font-weight:700;
    }
    .super-pill-row {
      display:flex;
      gap:8px;
      align-items:center;
      margin-bottom:10px;
    }
    .growth-pill {
      padding:5px 10px;
      border-radius: var(--radius-pill);
      background:rgba(0,0,0,0.22);
      display:flex;
      align-items:center;
      gap:6px;
      font-size:11px;
    }
    .growth-pill span.value {
      background:#09ba45;
      color:#021109;
      padding:2px 8px;
      border-radius: var(--radius-pill);
      font-weight:600;
      font-size:11px;
    }
    .growth-pill span.label { color:rgba(0,0,0,0.75); }
    .super-caption {
      font-size:11px;
      color:rgba(0,0,0,0.75);
    }

    .asset-breakdown {
      border-radius: 20px;
      background: rgba(0,0,0,0.24);
      padding: 10px 12px 8px;
      margin-bottom: 10px;
      display:none;
    }
    .asset-breakdown.active { display:block; }
    .asset-row {
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:13px;
      padding:4px 0;
    }
    .asset-row-label span.sub {
      display:block;
      font-size:11px;
      color:rgba(255,255,255,0.75);
    }
    .asset-row-value {
      font-weight:600;
      font-size:13px;
    }

    .super-actions-row {
      display:flex;
      gap:10px;
      margin-top:4px;
    }
    .super-action {
      flex:1;
      border-radius: 20px;
      background: rgba(0,0,0,0.26);
      padding:10px 10px 8px;
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      gap:6px;
      cursor:pointer;
      border:1px solid rgba(0,0,0,0.35);
      transition: var(--transition-fast);
    }
    .super-action-icon {
      width:26px;
      height:26px;
      border-radius: 999px;
      background:#101a11;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:16px;
    }
    .super-action-label {
      font-size:12px;
      font-weight:500;
    }
    .super-action:hover {
      transform: translateY(-1px);
      background: rgba(0,0,0,0.35);
    }

    /* Chegarasiz to'lovlar preview */
    .borderless-card {
      background: var(--card);
      border-radius: var(--radius-xl);
      padding: 14px 14px 12px;
      border:1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
      margin-bottom: 14px;
    }
    .section-title-row {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
    }
    .section-title-row h2 {
      font-size:16px;
      margin:0;
    }
    .section-sub {
      font-size:12px;
      color:var(--text-soft);
    }
    .chips-row {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:6px;
    }
    .chip {
      padding:6px 10px;
      border-radius: var(--radius-pill);
      background: rgba(255,255,255,0.02);
      border:1px solid var(--border-soft);
      font-size:12px;
      color:var(--text-soft);
      cursor:pointer;
    }
    .chip span.emoji { margin-right:4px; }

    /* Quick transfer forms (2-screen va boshqalar) */
    .screen-header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:8px 2px 10px;
    }
    .back-btn {
      border-radius: 999px;
      border:none;
      background:rgba(255,255,255,0.06);
      width:32px;
      height:32px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:var(--text-main);
      font-size:18px;
    }
    .screen-title-block {
      flex:1;
      text-align:center;
    }
    .screen-title-block h1 {
      margin:0;
      font-size:16px;
    }
    .screen-title-block span {
      font-size:11px;
      color:var(--text-soft);
    }
    .bal-mini {
      font-size:11px;
      padding:4px 10px;
      border-radius: var(--radius-pill);
      background:rgba(255,255,255,0.06);
    }

    .card {
      background: var(--card);
      border-radius: var(--radius-xl);
      padding: 14px 14px 14px;
      border:1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
      margin-bottom:14px;
    }
    .card h2 {
      margin:0 0 8px;
      font-size:16px;
    }
    .field-block { margin-bottom:10px; }
    .field-label {
      font-size:12px;
      margin-bottom:4px;
      color:var(--text-soft);
    }
    .select, .input {
      width:100%;
      padding:10px 12px;
      border-radius: var(--radius-lg);
      border:1px solid var(--border-soft);
      background:rgba(3,20,9,0.9);
      color:var(--text-main);
      font-size:14px;
    }
    .input::placeholder { color:rgba(255,255,255,0.35); }
    .fee-box {
      border-radius: var(--radius-lg);
      background:rgba(0,0,0,0.45);
      padding:10px 12px;
      font-size:12px;
      margin-top:4px;
    }
    .fee-row {
      display:flex;
      justify-content:space-between;
      padding:2px 0;
    }
    .btn-primary {
      width:100%;
      margin-top:10px;
      padding:12px 14px;
      border-radius: var(--radius-pill);
      border:none;
      font-size:14px;
      font-weight:600;
      background:linear-gradient(90deg,#46ff7f,#c8ff6a);
      color:#03230f;
      box-shadow:0 10px 25px rgba(0,0,0,0.55);
      cursor:pointer;
    }

    /* Profil modal */
    .modal-backdrop {
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.6);
      display:none;
      align-items:flex-end;
      justify-content:center;
      z-index:30;
    }
    .modal-backdrop.active { display:flex; }
    .modal-sheet {
      width:100%;
      max-width:480px;
      background: radial-gradient(circle at 0 0,#0cc14f 0,#04150a 45%);
      border-radius: 24px 24px 0 0;
      padding:16px 18px 20px;
      box-shadow:var(--shadow-soft);
    }
    .modal-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
    }
    .modal-header h2 {
      margin:0;
      font-size:18px;
    }
    .modal-close {
      border:none;
      background:rgba(0,0,0,0.22);
      width:30px;
      height:30px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:var(--text-main);
      font-size:18px;
    }
    .profile-info-line {
      font-size:13px;
      margin:4px 0;
    }
    .profile-info-line span.label {
      color:rgba(255,255,255,0.7);
      margin-right:4px;
    }
    .modal-actions {
      margin-top:14px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .btn-outline, .btn-danger {
      width:100%;
      padding:10px 14px;
      border-radius: var(--radius-pill);
      border:1px solid rgba(255,255,255,0.14);
      background:transparent;
      color:var(--text-main);
      font-size:14px;
    }
    .btn-danger {
      border-color:rgba(255,74,74,0.8);
      color:#ffe1e1;
      background:rgba(255,74,74,0.1);
    }
  </style>
</head>

<body>
  <div class="app-root">
    <!-- HOME / DASHBOARD -->
    <div id="screen-dashboard" class="screen active">
      <header class="app-header">
        <div class="header-left">
          <span class="app-header-title">AiSend</span>
          <span class="app-header-sub">Cross-border demo super balance</span>
        </div>
        <div class="header-right">
          <div id="demoConverter" class="pill-small">Demo konvertor</div>
          <button class="profile-pill" onclick="openProfileModal()">
            <div class="profile-avatar" id="profileAvatar">M</div>
            <div class="profile-labels">
              <span class="profile-name" id="profileNameShort">Profil</span>
              <span class="profile-handle" id="profileHandleShort">@demo</span>
            </div>
          </button>
        </div>
      </header>

      <section class="super-card">
        <div class="super-top">
          <div>
            <div class="super-title">AiSend ¬∑ DEMO</div>
            <div class="super-tagline">Super balance</div>
          </div>
          <button class="asset-toggle" onclick="toggleAssets()">
            <span id="assetToggleLabel">Barcha aktivlar</span>
            <span class="arrow" id="assetToggleArrow">‚ñæ</span>
          </button>
        </div>

        <div class="super-amount-row">
          <span class="super-amount-main" id="totalBalanceLabel">12 450,00</span>
          <span class="super-currency">USZ</span>
        </div>

        <div class="super-pill-row">
          <div class="growth-pill">
            <span class="value" id="growthValue">+3.4%</span>
            <span class="label">Oxirgi hafta (demo)</span>
          </div>
        </div>

        <div id="assetBreakdown" class="asset-breakdown">
          <div class="asset-row">
            <div class="asset-row-label">
              Fiat balans
              <span class="sub">UZS ¬∑ KZT ¬∑ KGS (demo)</span>
            </div>
            <div class="asset-row-value" id="fiatBalanceLabel">9 200,00 USZ</div>
          </div>
          <div class="asset-row">
            <div class="asset-row-label">
              Crypto (demo)
              <span class="sub">BTC ¬∑ ETH ¬∑ USDT</span>
            </div>
            <div class="asset-row-value" id="cryptoBalanceLabel">2 150,45 USZ</div>
          </div>
          <div class="asset-row">
            <div class="asset-row-label">
              Stocks (demo)
              <span class="sub">US / KZ bozorlar</span>
            </div>
            <div class="asset-row-value" id="stocksBalanceLabel">1 099,55 USZ</div>
          </div>
        </div>

        <div class="super-actions-row">
          <div class="super-action" onclick="showScreen('send')">
            <div class="super-action-icon">‚Üó</div>
            <div class="super-action-label">Send</div>
          </div>
          <div class="super-action" onclick="showScreen('exchange')">
            <div class="super-action-icon">‚áÑ</div>
            <div class="super-action-label">Exchange</div>
          </div>
          <div class="super-action" onclick="showScreen('crypto')">
            <div class="super-action-icon">‡∏ø</div>
            <div class="super-action-label">Crypto</div>
          </div>
          <div class="super-action" onclick="showScreen('stocks')">
            <div class="super-action-icon">üìà</div>
            <div class="super-action-label">Stocks</div>
          </div>
        </div>
      </section>

      <!-- Chegarasiz to'lovlar preview -->
      <section class="borderless-card">
        <div class="section-title-row">
          <div>
            <h2>Chegarasiz to‚Äòlovlar (demo)</h2>
            <div class="section-sub">
              Dunyo bo‚Äòylab komunal va xizmatlar uchun tezkor to‚Äòlovlar.
            </div>
          </div>
        </div>

        <div class="chips-row">
          <button class="chip" onclick="openSendWithService('electric')">
            <span class="emoji">üí°</span> Svet
          </button>
          <button class="chip" onclick="openSendWithService('gas')">
            <span class="emoji">üî•</span> Gaz
          </button>
          <button class="chip" onclick="openSendWithService('water')">
            <span class="emoji">üöø</span> Suv
          </button>
          <button class="chip" onclick="openSendWithService('mobile')">
            <span class="emoji">üì±</span> Operatorlar
          </button>
          <button class="chip" onclick="openSendWithService('other')">
            <span class="emoji">üåç</span> Boshqa xizmatlar
          </button>
        </div>
      </section>
    </div>

<!-- SEND SCREEN -->
    <div id="screen-send" class="screen">
      <header class="screen-header">
        <button class="back-btn" onclick="showScreen('dashboard')">‚Üê</button>
        <div class="screen-title-block">
          <h1>Send (demo)</h1>
          <span>UZS ‚Üí KZT / KGS tezkor o‚Äòtkazmalar</span>
        </div>
        <div class="bal-mini" id="miniBalanceLabel">12 450,00 USZ</div>
      </header>

      <section class="card">
        <h2 id="sendServiceTitle">Quick Transfer</h2>
        <p class="section-sub">
          UZS ‚Üí KZT / KGS kartaga tezkor o‚Äòtkazmalar (demo). Komissiyani oldindan ko‚Äòrasiz.
        </p>

        <div class="field-block">
          <div class="field-label">From valyuta</div>
          <select id="fromCurrency" class="select">
            <option value="UZS" selected>UZS (Uzbekistan)</option>
          </select>
        </div>

        <div class="field-block">
          <div class="field-label">To valyuta</div>
          <select id="toCurrency" class="select">
            <option value="KZT" selected>KZT (Kazakhstan)</option>
            <option value="KGS">KGS (Kyrgyzstan)</option>
          </select>
        </div>

        <div class="field-block">
          <div class="field-label">Miqdor</div>
          <input id="amountInput" class="input" type="number" min="0" placeholder="Miqdor kiriting" />
        </div>

        <div class="field-block">
          <div class="field-label">
            Qabul qiluvchi (demo) <span id="receiverHint">@username yoki karta raqam</span>
          </div>
          <input id="receiverInput" class="input" type="text" placeholder="@foydalanuvchi yoki karta 0000..." />
        </div>

        <div class="fee-box">
          <div class="fee-row">
            <span>Qabul qiluvchi oladi (taxminan)</span>
            <span id="payoutLabel">0,00 KZT</span>
          </div>
          <div class="fee-row">
            <span>Exchange fee (1%)</span>
            <span id="exchangeFeeLabel">0,00 KZT</span>
          </div>
          <div class="fee-row">
            <span>Transfer fee (1%)</span>
            <span id="transferFeeLabel">0,00 KZT</span>
          </div>
          <div class="fee-row">
            <span>Umumiy komissiya</span>
            <span id="totalFeeLabel">0,00 KZT</span>
          </div>
        </div>

        <button class="btn-primary" onclick="confirmSendDemo()">
          Yuborishni tasdiqlash (demo)
        </button>

        <p class="section-sub" style="margin-top:8px;">
          Demo: 1% exchange + 1% transfer komissiya. Real ilovada bu raqamlar litsenziyaga qarab o‚Äòzgaradi.
        </p>
      </section>
    </div>

    <!-- EXCHANGE SCREEN -->
    <div id="screen-exchange" class="screen">
      <header class="screen-header">
        <button class="back-btn" onclick="showScreen('dashboard')">‚Üê</button>
        <div class="screen-title-block">
          <h1>Exchange (demo)</h1>
          <span>Balans ichida UZS ‚áÑ KZT / KGS</span>
        </div>
        <div class="bal-mini">Super balance: <span id="miniBalanceEx">12 450,00</span> USZ</div>
      </header>

      <section class="card">
        <h2>Balansni almashish</h2>
        <p class="section-sub">
          Ichki balansni boshqa valyutaga o‚Äòtkazish (demo). 1% exchange fee.
        </p>

        <div class="field-block">
          <div class="field-label">From balans</div>
          <select id="exFrom" class="select">
            <option value="UZS" selected>UZS balans</option>
            <option value="KZT">KZT balans</option>
          </select>
        </div>

        <div class="field-block">
          <div class="field-label">To balans</div>
          <select id="exTo" class="select">
            <option value="KZT">KZT balans</option>
            <option value="KGS">KGS balans</option>
          </select>
        </div>

        <div class="field-block">
          <div class="field-label">Miqdor</div>
          <input id="exAmount" class="input" type="number" min="0" placeholder="Miqdor kiriting" />
        </div>

        <div class="fee-box">
          <div class="fee-row">
            <span>Exchange fee (1%)</span>
            <span id="exFeeLabel">0,00</span>
          </div>
          <div class="fee-row">
            <span>Qabul qiluvchi balans</span>
            <span id="exResultLabel">0,00</span>
          </div>
        </div>

        <button class="btn-primary" onclick="calcExchangeDemo()">Exchange qilish (demo)</button>
      </section>
    </div>

    <!-- CRYPTO SCREEN -->
    <div id="screen-crypto" class="screen">
      <header class="screen-header">
        <button class="back-btn" onclick="showScreen('dashboard')">‚Üê</button>
        <div class="screen-title-block">
          <h1>Crypto (demo)</h1>
          <span>USZ ‚Üí BTC / USDT "fake" kalkulyator</span>
        </div>
        <div class="bal-mini">Fiat balans: <span id="miniBalanceCrypto">9 200,00 USZ</span></div>
      </header>

      <section class="card">
        <h2>Crypto sotib olish (demo)</h2>
        <div class="field-block">
          <div class="field-label">Token</div>
          <select id="cryptoToken" class="select">
            <option value="BTC" selected>BTC</option>
            <option value="USDT">USDT</option>
          </select>
        </div>
        <div class="field-block">
          <div class="field-label">Fiat miqdor (USZ)</div>
          <input id="cryptoFiat" class="input" type="number" min="0" placeholder="Masalan: 1000" />
        </div>
        <div class="fee-box">
          <div class="fee-row">
            <span>Taxminiy kurs (demo)</span>
            <span id="cryptoRateLabel">1 BTC ‚âà 80 000 USZ</span>
          </div>
          <div class="fee-row">
            <span>Qabul qilinadigan token</span>
            <span id="cryptoAmountLabel">0.0000 BTC</span>
          </div>
        </div>
        <button class="btn-primary" onclick="calcCryptoDemo()">Hisoblash (demo)</button>
      </section>
    </div>

    <!-- STOCKS SCREEN -->
    <div id="screen-stocks" class="screen">
      <header class="screen-header">
        <button class="back-btn" onclick="showScreen('dashboard')">‚Üê</button>
        <div class="screen-title-block">
          <h1>Stocks (demo)</h1>
          <span>US / KZ bozorlar bo‚Äòyicha virtual portfel</span>
        </div>
        <div class="bal-mini">Stocks demo: 1 099,55 USZ</div>
      </header>

      <section class="card">
        <h2>Demo investitsiya</h2>
        <div class="field-block">
          <div class="field-label">Instrument</div>
          <select id="stockSymbol" class="select">
            <option value="AAPL">AAPL (US)</option>
            <option value="TSLA">TSLA (US)</option>
            <option value="KZTK">KZTK (KZ)</option>
          </select>
        </div>
        <div class="field-block">
          <div class="field-label">Miqdor (USZ)</div>
          <input id="stockAmount" class="input" type="number" min="0" placeholder="Masalan: 500" />
        </div>
        <div class="fee-box">
          <div class="fee-row">
            <span>Taxminiy lotlar soni (demo)</span>
            <span id="stockLotsLabel">0.00</span>
          </div>
        </div>
        <button class="btn-primary" onclick="calcStocksDemo()">Hisoblash (demo)</button>
      </section>
    </div>

    <!-- PROFILE MODAL -->
    <div id="profileModal" class="modal-backdrop" onclick="backdropClick(event)">
      <div class="modal-sheet">
        <div class="modal-header">
          <h2>Telegram profil</h2>
          <button class="modal-close" onclick="closeProfileModal()">√ó</button>
        </div>

        <div class="profile-info-line"><span class="label">Ism:</span><span id="pfName">‚Äì</span></div>
        <div class="profile-info-line"><span class="label">ID:</span><span id="pfId">‚Äì</span></div>
        <div class="profile-info-line"><span class="label">Username:</span><span id="pfUsername">‚Äì</span></div>

        <div class="modal-actions">
          <button class="btn-outline">Sozlamalar (tez orada)</button>
          <button class="btn-danger">Chiqish (tez orada)</button>
        </div>
      </div>
    </div>
  </div>

<script>
    const DEMO_RATE_UZS_KZT = 0.040;   // 1 UZS ‚âà 0.04 KZT (demo)
    const EXCHANGE_FEE_PCT = 0.01;
    const TRANSFER_FEE_PCT = 0.01;

    function formatMoney(value, currency) {
      const v = Number(value || 0);
      return v.toLocaleString("ru-RU", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }) + " " + (currency || "");
    }

    function showScreen(name) {
      document.querySelectorAll(".screen").forEach(el => {
        el.classList.toggle("active", el.id === "screen-" + name);
      });
    }

    // Barcha aktivlar toggler
    function toggleAssets() {
      const box = document.getElementById("assetBreakdown");
      const label = document.getElementById("assetToggleLabel");
      const arrow = document.getElementById("assetToggleArrow");
      const active = !box.classList.contains("active");
      box.classList.toggle("active", active);
      label.textContent = active ? "Yopish" : "Barcha aktivlar";
      arrow.textContent = active ? "‚ñ¥" : "‚ñæ";
    }

    // Chegarasiz to'lov chiplariga bosilganda:
    function openSendWithService(serviceKey) {
      showScreen("send");
      const map = {
        electric: "Svet uchun to‚Äòlov (demo)",
        gas: "Gaz uchun to‚Äòlov (demo)",
        water: "Suv uchun to‚Äòlov (demo)",
        mobile: "Mobil operatorlar (demo)",
        other: "Chegarasiz to‚Äòlovlar (demo)"
      };
      const title = map[serviceKey] || map.other;
      document.getElementById("sendServiceTitle").textContent = title;
      document.getElementById("receiverHint").textContent =
        "abonent raqami yoki shaxsiy hisob (demo)";
    }

    // QUICK TRANSFER DEMO
    function recalcSend() {
      const amount = Number(document.getElementById("amountInput").value || 0);
      const toCur = document.getElementById("toCurrency").value;
      const baseInKZT = amount * DEMO_RATE_UZS_KZT;
      const exchangeFee = baseInKZT * EXCHANGE_FEE_PCT;
      const transferFee = baseInKZT * TRANSFER_FEE_PCT;
      const totalFee = exchangeFee + transferFee;
      const payout = baseInKZT - totalFee;

      const cur = toCur;
      document.getElementById("exchangeFeeLabel").textContent = formatMoney(exchangeFee, cur);
      document.getElementById("transferFeeLabel").textContent = formatMoney(transferFee, cur);
      document.getElementById("totalFeeLabel").textContent = formatMoney(totalFee, cur);
      document.getElementById("payoutLabel").textContent = formatMoney(Math.max(payout,0), cur);
    }

    function confirmSendDemo() {
      recalcSend();
      alert("Demo rejim: tranzaksiya faqat simulyatsiya qilindi ‚úÖ");
    }

    ["amountInput","toCurrency"].forEach(id => {
      const el = document.getElementById(id);
      el && el.addEventListener("input", recalcSend);
      el && el.addEventListener("change", recalcSend);
    });

    // EXCHANGE DEMO
    function calcExchangeDemo() {
      const amount = Number(document.getElementById("exAmount").value || 0);
      const fee = amount * EXCHANGE_FEE_PCT;
      const result = amount - fee;
      document.getElementById("exFeeLabel").textContent = formatMoney(fee, "");
      document.getElementById("exResultLabel").textContent = formatMoney(Math.max(result,0), "");
    }

    // CRYPTO DEMO
    function calcCryptoDemo() {
      const token = document.getElementById("cryptoToken").value;
      const fiat = Number(document.getElementById("cryptoFiat").value || 0);
      const rate = token === "BTC" ? 80000 : 1; // 1 USDT ‚âà 1 USZ (demo)
      const amount = rate ? fiat / rate : 0;
      document.getElementById("cryptoRateLabel").textContent =
        token === "BTC"
          ? "1 BTC ‚âà 80 000 USZ (demo)"
          : "1 USDT ‚âà 1 USZ (demo)";
      document.getElementById("cryptoAmountLabel").textContent =
        amount.toFixed(token === "BTC" ? 4 : 2) + " " + token;
    }

    // STOCKS DEMO
    function calcStocksDemo() {
      const symbol = document.getElementById("stockSymbol").value;
      const amt = Number(document.getElementById("stockAmount").value || 0);
      const prices = { AAPL: 180, TSLA: 220, KZTK: 150 }; // demo
      const lots = amt / (prices[symbol] || 1);
      document.getElementById("stockLotsLabel").textContent = lots.toFixed(2) + " lot";
    }

    // PROFILE MODAL
    function openProfileModal() {
      document.getElementById("profileModal").classList.add("active");
    }
    function closeProfileModal() {
      document.getElementById("profileModal").classList.remove("active");
    }
    function backdropClick(ev) {
      if (ev.target.id === "profileModal") closeProfileModal();
    }

    // Telegram WebApp init ‚Äì profil va ism/id ni yuklash
    (function initTelegramProfile(){
      try {
        if (!window.Telegram || !Telegram.WebApp) return;
        const tg = Telegram.WebApp;
        tg.ready();
        const u = tg.initDataUnsafe && tg.initDataUnsafe.user;
        if (!u) return;

        const fullName = [u.first_name, u.last_name].filter(Boolean).join(" ");
        const shortName = fullName || "Foydalanuvchi";
        const username = u.username ? "@" + u.username : "‚Äì";
        const id = u.id ? String(u.id) : "‚Äì";

        // header pill
        document.getElementById("profileAvatar").textContent =
          shortName.charAt(0).toUpperCase();
        document.getElementById("profileNameShort").textContent = shortName;
        document.getElementById("profileHandleShort").textContent = username;

        // modal
        document.getElementById("pfName").textContent = fullName || "‚Äì";
        document.getElementById("pfId").textContent = id;
        document.getElementById("pfUsername").textContent = username;
      } catch (e) {
        console.warn("Telegram initDataUnsafe o‚Äòqishda xato:", e);
      }
    })();
  </script>
</body>
</html>

