<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AiSend Demo</title>

  <style>
    body {
      background: #081b00;
      color: #e8ffe3;
      font-family: "Inter", sans-serif;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 500px;
      margin: auto;
      padding: 16px;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .profile-btn {
      padding: 8px 18px;
      border-radius: 30px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      font-size: 14px;
    }

    /* Card */
    .card {
      background: linear-gradient(135deg, #123600 0%, #0b2200 100%);
      padding: 18px;
      border-radius: 22px;
      margin-bottom: 20px;
      box-shadow: 0 0 20px rgba(23,255,68,0.15);
      border: 1px solid rgba(34,255,72,0.2);
    }

    .title {
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    /* Forms */
    select, input {
      width: 100%;
      padding: 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.05);
      color: #d5ffd0;
      font-size: 16px;
      margin-bottom: 12px;
    }

    /* Toggle */
    .toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    /* Button (gradient) */
    .btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(90deg, #baff69, #88ff22);
      border: none;
      border-radius: 22px;
      text-align: center;
      font-size: 20px;
      color: #0c3000;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
    }

    .btn-loading {
      opacity: 0.5;
      pointer-events: none;
    }

    .spinner {
      border: 3px solid rgba(255,255,255,0.3);
      border-top: 3px solid white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: inline-block;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      100% { transform: rotate(360deg); }
    }

    /* Profile modal */
    .modal-bg {
      position: fixed;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(5px);
      display: none;
      justify-content: center;
      align-items: flex-end;
      padding: 20px;
    }

    .modal {
      width: 100%;
      max-width: 500px;
      background: #112600;
      padding: 20px;
      border-radius: 24px 24px 0 0;
      border: 1px solid #1aff3a55;
    }

    .modal-title {
      font-size: 22px;
      font-weight: bold;
      margin-bottom: 16px;
    }

    .modal-item {
      margin-bottom: 8px;
      font-size: 16px;
    }

    .logout-btn {
      width: 100%;
      text-align: center;
      padding: 14px;
      background: #330000;
      border: 1px solid #ff4444;
      color: #ffcccc;
      border-radius: 18px;
      margin-top: 18px;
    }
/* SEND MONEY UI */

    .section-label {
      font-size: 14px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      opacity: 0.7;
      margin: 4px 0 10px;
    }

    .send-card-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .chips-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .chip {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.15);
      font-size: 11px;
      opacity: 0.85;
    }

    .recipient-row {
      display: flex;
      align-items: center;
      margin: 10px 0 14px;
    }

    .avatar {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 0%, #eaff77, #32ff6c);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #042100;
      font-weight: 700;
      font-size: 16px;
    }

    .rec-info {
      margin-left: 10px;
      font-size: 13px;
    }

    .rec-info .name {
      font-weight: 600;
    }

    .rec-info .phone {
      opacity: 0.8;
      font-size: 12px;
    }

    .amount-big {
      font-size: 24px;
      font-weight: 600;
      padding: 12px 14px;
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(0, 0, 0, 0.18);
      color: #e9ffe3;
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 10px;
    }

    .input-label-row {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      opacity: 0.8;
      margin-bottom: 4px;
    }

    .note-input {
      font-size: 13px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      background: rgba(0, 0, 0, 0.16);
      color: #e9ffe3;
      width: 100%;
      box-sizing: border-box;
      margin-top: 6px;
    }

    .hold-btn {
      position: relative;
      overflow: hidden;
      margin-top: 16px;
      width: 100%;
      padding: 15px;
      border-radius: 24px;
      border: none;
      cursor: pointer;
      background: linear-gradient(90deg, #c2ff65, #80ff1e);
      color: #052200;
      font-weight: 700;
      font-size: 16px;
    }

    .hold-fill {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 0%;
      background: rgba(0, 60, 0, 0.18);
      pointer-events: none;
      transition: width 0.1s linear;
    }

    .hold-btn span.hold-label {
      position: relative;
      z-index: 2;
    }

    .send-status {
      margin-top: 10px;
      font-size: 13px;
      min-height: 18px;
    }

    .send-status.ok {
      color: #86ff7a;
    }

    .send-status.err {
      color: #ff8080;
    }
  </style>
</head>

<body>
<div class="container">

  <div class="header">
    <h2>AiSend</h2>
    <button class="profile-btn" id="profileOpen">Profil</button>
  </div>
<div class="card">
      <div class="title">AiSend Pay</div>
      <p>UZS balansdan KZT/KGS kartaga tezkor o‘tkazmalar (demo).</p>
  </div>

  <!-- Direction -->
  <div class="card">
    <label>Yo‘nalishni tanlang</label>
    <select id="direction">
      <option value="UZS_KZT">UZS → KZT</option>
      <option value="UZS_KGS">UZS → KGS</option>
    </select>

    <label>Miqdor</label>
    <input id="amount" placeholder="Miqdor kiriting" />

    <div class="toggle-row">
      <span>Onlayn kurslar</span>
      <input type="checkbox" id="liveToggle" checked />
    </div>

    <button class="btn" id="calcBtn">Hisoblash</button>

    <div id="resultBox" style="margin-top:18px; font-size:22px;">
      0 UZS ≈ 0 KZT
    </div>

    <div id="baseRate" style="opacity:0.7; margin-top:6px;">
      1 UZS ≈ demo kurs
    </div>
  </div>
<!-- SEND MONEY CARD -->
  <div class="card">

    <div class="section-label">Transfer</div>
    <div class="send-card-title">Send Money</div>

    <div class="chips-row">
      <div class="chip">UZS balans → AiSend do‘st</div>
      <div class="chip">0% komissiya (demo)</div>
    </div>

    <div class="recipient-row">
      <div class="avatar">AV</div>
      <div class="rec-info">
        <div class="name" id="send_name">Alisher Valiyev</div>
        <div class="phone" id="send_phone">+998 90 123 45 67</div>
      </div>
    </div>

    <div class="input-label-row">
      <span>Miqdor</span>
      <span>Valyuta: UZS</span>
    </div>
    <input
      id="send_amount"
      class="amount-big"
      type="number"
      inputmode="decimal"
      placeholder="500000"
    />

    <div class="input-label-row">
      <span>Izoh (ixtiyoriy)</span>
      <span style="opacity:0.6;">Masalan: “Uyga pul”</span>
    </div>
    <input
      id="send_note"
      class="note-input"
      placeholder="Izoh qoldiring (demo)"
    />

    <button class="hold-btn" id="holdSend">
      <div class="hold-fill" id="holdFill"></div>
      <span class="hold-label">Yuborish uchun ushlab turing</span>
    </button>

    <div id="sendStatus" class="send-status"></div>
  </div>
<!-- PROFILE MODAL -->
<div class="modal-bg" id="profileBg">
  <div class="modal">
    <div class="modal-title">Telegram profil</div>

    <div class="modal-item">Ism: <span id="pf_name">-</span></div>
    <div class="modal-item">ID: <span id="pf_id">-</span></div>
    <div class="modal-item">Username: <span id="pf_user">-</span></div>

    <button class="logout-btn">Chiqish (tez orada)</button>
  </div>
</div>


<script>
const amountEl   = document.getElementById("amount");
const directionEl = document.getElementById("direction");
const toggleEl    = document.getElementById("liveToggle");
const calcBtn     = document.getElementById("calcBtn");
const resultBox   = document.getElementById("resultBox");
const baseRateEl  = document.getElementById("baseRate");

/* Demo rates */
const DEMO = { "UZS_KZT": 0.04, "UZS_KGS": 0.009 };

/* FETCH Live rate */
async function fetchRate(from, to) {
  const url = `/api/rates?from=${from}&to=${to}`;
  const res = await fetch(url);
  const json = await res.json();
  return json.rates[to];
}

/* Recalc */
async function recalc() {
  const val = parseFloat(amountEl.value);
  if (!val || val <= 0) {
    resultBox.textContent = "0 UZS ≈ 0";
    return;
  }

  const dir = directionEl.value;
  const [from, to] = dir.split("_");

  let rate = DEMO[dir];

  if (toggleEl.checked) {
    try {
      rate = await fetchRate(from, to);
    } catch (err) {}
  }

  const result = val * rate;
  resultBox.textContent = `${val} UZS ≈ ${result.toFixed(0)} ${to}`;
  baseRateEl.textContent = `1 UZS ≈ ${rate} ${to} (${toggleEl.checked ? "onlayn" : "demo"})`;
}

/* Button loading */
calcBtn.addEventListener("click", async () => {
  const old = calcBtn.textContent;
  calcBtn.classList.add("btn-loading");
  calcBtn.innerHTML = `<span class="spinner"></span> Hisoblanmoqda...`;

  await recalc();

  setTimeout(() => {
    calcBtn.classList.remove("btn-loading");
    calcBtn.textContent = old;
  }, 600);
});

/* Profile modal */
document.getElementById("profileOpen").onclick = () => {
  document.getElementById("profileBg").style.display = "flex";
};
document.getElementById("profileBg").onclick = (e) => {
  if (e.target.id === "profileBg") e.target.style.display = "none";
};

/* LOAD Telegram data */
(function loadProfile() {
  const p = new URLSearchParams(window.location.search);
  document.getElementById("pf_name").textContent = p.get("tg_name") || "-";
  document.getElementById("pf_id").textContent   = p.get("tg_id")   || "-";
  document.getElementById("pf_user").textContent = p.get("tg_username")
      ? ("@" + p.get("tg_username")) : "-";
})();

// ===== SEND MONEY: HOLD TO SEND DEMO =====
(function initSendMoney() {
  const holdBtn    = document.getElementById("holdSend");
  const holdFill   = document.getElementById("holdFill");
  const sendStatus = document.getElementById("sendStatus");
  const sendAmount = document.getElementById("send_amount");

  if (!holdBtn) return;

  let holdTimer = null;
  let progressTimer = null;

  function resetHold() {
    clearTimeout(holdTimer);
    clearInterval(progressTimer);
    holdFill.style.width = "0%";
    holdBtn.classList.remove("holding");
  }

  function startHold() {
    const val = parseFloat(sendAmount.value);
    if (!val || val <= 0) {
      sendStatus.textContent = "Miqdor kiriting.";
      sendStatus.className = "send-status err";
      return;
    }

    sendStatus.textContent = "Ushlab turing...";
    sendStatus.className = "send-status";

    let progress = 0;
    holdFill.style.width = "0%";
    holdBtn.classList.add("holding");

    progressTimer = setInterval(() => {
      progress = Math.min(progress + 10, 100);
      holdFill.style.width = progress + "%";
    }, 100);

    holdTimer = setTimeout(() => {
      resetHold();
      sendStatus.textContent = "Demo: to‘lov yuborildi ✅";
      sendStatus.className = "send-status ok";
    }, 1000); // 1 soniya ushlasa — yuborildi deb hisoblaymiz
  }

  function cancelHold() {
    if (!holdBtn.classList.contains("holding")) return;
    resetHold();
    sendStatus.textContent = "";
  }

  ["mousedown", "touchstart"].forEach(ev =>
    holdBtn.addEventListener(ev, e => {
      e.preventDefault();
      startHold();
    })
  );

  ["mouseup", "mouseleave", "touchend", "touchcancel"].forEach(ev =>
    holdBtn.addEventListener(ev, e => {
      e.preventDefault();
      cancelHold();
    })
  );
})();

</script>

</div> <!-- container -->
</body>
</html>
