<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AiSend ¬∑ Super balance demo</title>
  <style>
    :root {
      --bg-main: #02140a;
      --card-main: #06361a;
      --card-soft: #0b4621;
      --accent: #9dfc4f;
      --accent-soft: #193d1d;
      --text-main: #f5fff3;
      --text-muted: #a2c8a4;
      --danger: #ff4b4b;
      --radius-xl: 24px;
      --radius-lg: 18px;
      --radius-md: 12px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Roboto", sans-serif;
      background: radial-gradient(circle at top, #0a4d1e 0, #02140a 55%, #000 100%);
      color: var(--text-main);
    }

    #app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      padding: 16px 16px 28px;
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .app-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .app-title-main {
      font-weight: 700;
      font-size: 22px;
      letter-spacing: 0.03em;
    }

    .app-title-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    .profile-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(157, 252, 79, 0.3);
      background: radial-gradient(circle at top, #1c6b28 0, #062411 60%);
      color: var(--text-main);
      font-size: 12px;
    }

    .profile-pill-avatar {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: linear-gradient(135deg, #9dfc4f, #42ff9c);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #03210c;
      font-size: 13px;
    }

    .profile-pill-name {
      max-width: 120px;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .profile-pill-tag {
      opacity: 0.8;
      font-size: 11px;
    }

    .pill-demo {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.35);
      font-size: 11px;
      color: var(--text-muted);
    }

    .pill-demo-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #9dfc4f;
    }

    .card {
      border-radius: var(--radius-xl);
      background: radial-gradient(circle at top left, #0c5a26 0, #031a0d 55%);
      padding: 18px 18px 16px;
      box-shadow: 0 24px 40px rgba(0, 0, 0, 0.6);
    }

    .card-soft {
      border-radius: var(--radius-xl);
      background: linear-gradient(180deg, #032010 0, #020b06 100%);
      padding: 18px 18px 16px;
      margin-top: 14px;
      box-shadow: 0 18px 32px rgba(0, 0, 0, 0.6);
    }

    .super-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .super-label {
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .super-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(1, 16, 8, 0.85);
      border: 1px solid rgba(157, 252, 79, 0.38);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .super-badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #9dfc4f;
    }

    .super-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .super-amount-row {
      display: flex;
      align-items: baseline;
      gap: 6px;
      margin-bottom: 8px;
    }

    .super-amount {
      font-size: 30px;
      font-weight: 700;
    }

    .super-currency {
      font-size: 18px;
      opacity: 0.8;
    }

    .growth-chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(0, 0, 0, 0.3);
      margin-bottom: 10px;
    }

    .growth-chip span:first-child {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 46px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #0c5a26;
      color: #baff80;
      font-weight: 600;
      font-size: 11px;
    }

    .assets-toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 2px;
      margin-bottom: 4px;
    }

    .assets-toggle-btn {
      border: none;
      outline: none;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.3);
      color: var(--text-muted);
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .assets-toggle-btn span.chevron {
      font-size: 10px;
      opacity: 0.7;
    }

    .assets-list {
      margin-top: 4px;
      padding-top: 8px;
      border-top: 1px dashed rgba(255, 255, 255, 0.06);
    }

    .asset-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
    }

    .asset-row-label {
      font-size: 12px;
      color: var(--text-muted);
    }

    .asset-row-value {
      font-size: 13px;
      font-weight: 500;
    }

    .asset-row-sub {
      font-size: 10px;
      color: var(--text-muted);
      opacity: 0.9;
    }

    .actions-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
      margin-top: 14px;
    }

    .action-btn {
      border-radius: 18px;
      border: none;
      padding: 8px 4px 10px;
      background: rgba(1, 16, 8, 0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--text-main);
    }

    .action-icon {
      width: 32px;
      height: 32px;
      border-radius: 14px;
      background: radial-gradient(circle at top, #9dfc4f 0, #1d5d28 70%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      color: #021407;
      box-shadow: 0 10px 18px rgba(0, 0, 0, 0.6);
    }

    .action-btn.exchange .action-icon {
      background: radial-gradient(circle at top, #ffe96c 0, #9b7c1b 70%);
    }

    .action-btn.crypto .action-icon {
      background: radial-gradient(circle at top, #ffd86b 0, #c66a18 65%);
    }

    .action-btn.stocks .action-icon {
      background: radial-gradient(circle at top, #ff9df4 0, #91318e 70%);
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .tag-chip {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.38);
      color: var(--text-muted);
    }

    .btn-primary {
      border-radius: 999px;
      border: none;
      width: 100%;
      padding: 10px 14px;
      background: linear-gradient(90deg, #9dfc4f, #42ff9c);
      color: #021107;
      font-size: 14px;
      font-weight: 600;
      margin-top: 8px;
    }

    .btn-primary span.secondary {
      font-weight: 400;
      opacity: 0.9;
      font-size: 12px;
    }

    .legend {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 10px;
      line-height: 1.4;
    }

    /* Sub screens */

    .sub-top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }

    .sub-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .icon-circle {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .sub-title-main {
      font-weight: 600;
      font-size: 18px;
    }

    .sub-title-sub {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .balance-pill {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(0, 0, 0, 0.5);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .back-btn {
      border: none;
      background: transparent;
      color: var(--text-main);
      font-size: 24px;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .form-group {
      margin-bottom: 12px;
    }

    .form-label {
      display: block;
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .input,
    .select {
      width: 100%;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      padding: 10px 12px;
      background: rgba(0, 0, 0, 0.35);
      color: var(--text-main);
      font-size: 14px;
      outline: none;
    }

    .select {
      padding-right: 32px;
    }

    .input::placeholder {
      color: rgba(255, 255, 255, 0.3);
    }

    .result-box {
      margin-top: 6px;
      padding: 8px 10px;
      border-radius: 16px;
      background: rgba(0, 0, 0, 0.28);
      font-size: 12px;
      color: var(--text-muted);
    }

    .result-line {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2px;
    }

    .btn-secondary {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 10px 14px;
      background: linear-gradient(90deg, #9dfc4f, #6bffce);
      color: #021107;
      font-size: 14px;
      font-weight: 600;
      margin-top: 8px;
    }

    .btn-secondary:active,
    .btn-primary:active {
      transform: translateY(1px);
      filter: brightness(0.97);
    }

    /* Bottom sheet (profile) */

    .sheet-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.65);
      display: none;
      z-index: 40;
    }

    .sheet-backdrop.visible {
      display: block;
    }

    .sheet {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      max-width: 480px;
      margin: 0 auto;
      border-radius: 24px 24px 0 0;
      background: radial-gradient(circle at top, #0b4221 0, #020c06 70%);
      padding: 16px 18px 18px;
      box-shadow: 0 -18px 32px rgba(0, 0, 0, 0.8);
    }

    .sheet-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .sheet-title {
      font-size: 18px;
      font-weight: 600;
    }

    .sheet-close {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: none;
      background: rgba(0, 0, 0, 0.6);
      color: var(--text-main);
      font-size: 18px;
    }

    .divider {
      border: none;
      border-top: 1px dashed rgba(255, 255, 255, 0.14);
      margin: 10px 0 12px;
    }

    .profile-row {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .profile-label {
      color: var(--text-muted);
    }

    .profile-value {
      max-width: 180px;
      text-align: right;
      word-break: break-all;
    }

    .sheet-btn-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 14px;
    }

    .btn-outline {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      padding: 10px 14px;
      background: transparent;
      color: var(--text-main);
      font-size: 14px;
      font-weight: 500;
    }

    .btn-danger {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 10px 14px;
      background: linear-gradient(90deg, #ff5f5f, #e62b3f);
      color: #fffaf5;
      font-size: 14px;
      font-weight: 600;
    }
  </style>
</head>
<body>
<main id="app">

  <!-- MAIN SCREEN -->
  <section id="screen-main" class="screen active">
    <header class="top-bar">
      <div class="app-title">
        <div class="app-title-main">AiSend</div>
        <div class="app-title-sub">Cross-border demo super balance</div>
      </div>
      <button id="profileOpen" class="profile-pill" type="button">
        <div class="profile-pill-avatar" id="profileAvatar">TG</div>
        <div>
          <div class="profile-pill-name" id="profileNameShort">Profil</div>
          <div class="profile-pill-tag">@demo</div>
        </div>
      </button>
    </header>
<!-- Super balance card -->
    <div class="card">
      <div class="super-header-row">
        <div class="super-label">AISEND ¬∑ DEMO</div>
        <div class="super-badge">
          <span class="super-badge-dot"></span>
          <span id="badgeText">Super balance</span>
        </div>
      </div>

      <div class="super-title">Super balance</div>

      <div class="super-amount-row">
        <div class="super-amount" id="superAmount">12 450,00</div>
        <div class="super-currency">USZ</div>
      </div>

      <div class="growth-chip">
        <span id="growthValue">+3.4%</span>
        <span>Oxirgi hafta (demo)</span>
      </div>

      <div class="assets-toggle-row">
        <button id="assetsToggle" type="button" class="assets-toggle-btn">
          <span id="assetsToggleLabel">Barcha aktivlar</span>
          <span class="chevron" id="assetsToggleChevron">‚ñº</span>
        </button>
      </div>

      <div id="assetDetails" class="assets-list" style="display: none;">
        <div class="asset-row">
          <div>
            <div class="asset-row-label">Fiat balans</div>
            <div class="asset-row-sub">UZS / KZT / KGS (demo)</div>
          </div>
          <div class="asset-row-value" id="assetFiat">9 200,00 USZ</div>
        </div>
        <div class="asset-row">
          <div>
            <div class="asset-row-label">Crypto (demo)</div>
            <div class="asset-row-sub">BTC ¬∑ ETH ¬∑ USDT (demo)</div>
          </div>
          <div class="asset-row-value" id="assetCrypto">2 150,45 USZ</div>
        </div>
        <div class="asset-row">
          <div>
            <div class="asset-row-label">Stocks (demo)</div>
            <div class="asset-row-sub">US / KZ bozorlar (demo)</div>
          </div>
          <div class="asset-row-value" id="assetStocks">1 099,55 USZ</div>
        </div>
      </div>

      <!-- Actions -->
      <div class="actions-grid">
        <button class="action-btn" type="button" onclick="openScreen('send')">
          <div class="action-icon">‚Üë</div>
          <div>Send</div>
        </button>
        <button class="action-btn exchange" type="button" onclick="openScreen('exchange')">
          <div class="action-icon">‚áÑ</div>
          <div>Exchange</div>
        </button>
        <button class="action-btn crypto" type="button" onclick="openScreen('crypto')">
          <div class="action-icon">‚Çø</div>
          <div>Crypto</div>
        </button>
        <button class="action-btn stocks" type="button" onclick="openScreen('stocks')">
          <div class="action-icon">üìà</div>
          <div>Stocks</div>
        </button>
      </div>
    </div>

    <!-- Chegarasiz to‚Äòlovlar (cross-border utilities) -->
    <div class="card-soft">
      <div class="card-title">Chegarasiz to‚Äòlovlar (demo)</div>
      <div class="card-subtitle">
        O‚Äòzbekistondagi uy-ro‚Äòzg‚Äòor hisoblaringni (gaz, suv, svet, operatorlar)
        boshqa davlatdan turib USZ bilan to‚Äòlash g‚Äòoyasi.
      </div>

      <div class="tag-row">
        <div class="tag-chip">Gaz</div>
        <div class="tag-chip">Suv</div>
        <div class="tag-chip">Svet</div>
        <div class="tag-chip">Mobil operatorlar</div>
        <div class="tag-chip">Internet</div>
      </div>

      <button class="btn-primary" type="button">
        Chegarasiz to‚Äòlov demo
        <span class="secondary"> ¬∑ tez orada</span>
      </button>

      <div class="legend">
        Demo rejimi: bu bo‚Äòlim hozircha faqat konsept. Real loyihada bu yerda
        billing provayderlari, limitlar va KYC talablari paydo bo‚Äòladi.
      </div>
    </div>
  </section>

  <!-- PROFILE SHEET -->
  <div id="sheetBackdrop" class="sheet-backdrop">
    <div class="sheet">
      <div class="sheet-header">
        <div class="sheet-title">Telegram profil</div>
        <button id="profileClose" class="sheet-close" type="button">√ó</button>
      </div>

      <div class="profile-row">
        <div class="profile-label">Ism:</div>
        <div class="profile-value" id="pfName">-</div>
      </div>
      <div class="profile-row">
        <div class="profile-label">ID:</div>
        <div class="profile-value" id="pfId">-</div>
      </div>
      <div class="profile-row">
        <div class="profile-label">Username:</div>
        <div class="profile-value" id="pfUsername">-</div>
      </div>

      <hr class="divider" />

      <div class="legend">
        Ma‚Äôlumotlar faqat Telegram WebApp initDataUnsafe‚Äôdan olinadi va
        AiSend demo ichida lokal ishlatiladi.
      </div>

      <div class="sheet-btn-row">
        <button class="btn-outline" type="button">
          Sozlamalar (tez orada)
        </button>
        <button class="btn-danger" type="button">
          Chiqish (tez orada)
        </button>
      </div>
    </div>
  </div>
<!-- SEND SCREEN -->
  <section id="screen-send" class="screen">
    <header class="sub-top-bar">
      <div class="sub-left">
        <button class="back-btn" type="button" onclick="openScreen('main')">‚Äπ</button>
        <div>
          <div class="sub-title-main">Send (demo)</div>
          <div class="sub-title-sub">UZS ‚Üí KZT / KGS tezkor o‚Äòtkazmalar</div>
        </div>
      </div>
      <div class="balance-pill">
        <span>Super balance:</span>
        <span id="sendSuperBalance">12 450,00 USZ</span>
      </div>
    </header>

    <div class="card">
      <div class="card-title">Quick Transfer</div>
      <div class="card-subtitle">
        UZS ‚Üí KZT / KGS kartaga tezkor o‚Äòtkazmalar (demo). Komissiyani
        oldindan ko‚Äòrasiz.
      </div>

      <div class="form-group">
        <label class="form-label">From valyuta</label>
        <select id="sendFromCurrency" class="select">
          <option value="UZS">UZS (Uzbekistan)</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">To valyuta</label>
        <select id="sendToCurrency" class="select">
          <option value="KZT">KZT (Kazakhstan)</option>
          <option value="KGS">KGS (Kyrgyzstan)</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Miqdor</label>
        <input
          id="sendAmount"
          class="input"
          type="number"
          min="0"
          step="0.01"
          placeholder="Miqdor kiriting"
        />
      </div>

      <div class="form-group">
        <label class="form-label">
          Qabul qiluvchi (demo) <span style="opacity:0.7">@username yoki karta raqam</span>
        </label>
        <input
          id="sendRecipient"
          class="input"
          type="text"
          placeholder="@foydalanuvchi yoki karta 0000‚Ä¶"
        />
      </div>

      <div class="result-box">
        <div class="result-line">
          <span>Qabul qiluvchi oladi (taxminan)</span>
          <span id="sendReceiverGets">0,00 KZT</span>
        </div>
        <div class="result-line">
          <span>Exchange fee (1%)</span>
          <span id="sendFeeExchange">0,00 KZT</span>
        </div>
        <div class="result-line">
          <span>Transfer fee (1%)</span>
          <span id="sendFeeTransfer">0,00 KZT</span>
        </div>
        <div class="result-line">
          <span>Umumiy komissiya</span>
          <span id="sendFeeTotal">0,00 KZT</span>
        </div>
      </div>

      <button id="sendSubmit" class="btn-secondary" type="button">
        Yuborishni tasdiqlash (demo)
      </button>

      <div class="legend">
        Demo: 1% exchange + 1% transfer komissiya. Real ilovada bu raqamlar
        litsenziya va bozor sharoitiga qarab o‚Äòzgaradi.
      </div>
    </div>
  </section>

  <!-- EXCHANGE SCREEN -->
  <section id="screen-exchange" class="screen">
    <header class="sub-top-bar">
      <div class="sub-left">
        <button class="back-btn" type="button" onclick="openScreen('main')">‚Äπ</button>
        <div>
          <div class="sub-title-main">Exchange (demo)</div>
          <div class="sub-title-sub">
            Balans ichida UZS ‚áÑ KZT / KGS (demo)
          </div>
        </div>
      </div>
      <div class="balance-pill">
        <span>Super balance:</span>
        <span id="exSuperBalance">12 450,00 USZ</span>
      </div>
    </header>

    <div class="card">
      <div class="card-title">Balansni almashtirish</div>
      <div class="card-subtitle">
        Ichki balansni boshqa valyutaga o‚Äòtkazish (demo). 1% exchange fee.
      </div>

      <div class="form-group">
        <label class="form-label">From balans</label>
        <select id="exFrom" class="select">
          <option value="UZS">UZS balans</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">To balans</label>
        <select id="exTo" class="select">
          <option value="KZT">KZT balans</option>
          <option value="KGS">KGS balans</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Miqdor</label>
        <input
          id="exAmount"
          class="input"
          type="number"
          min="0"
          step="0.01"
          placeholder="Miqdor kiriting"
        />
      </div>

      <div class="result-box">
        <div class="result-line">
          <span>Exchange fee (1%)</span>
          <span id="exFee">0,00</span>
        </div>
        <div class="result-line">
          <span>Qabul qiluvchi balans</span>
          <span id="exResult">0,00</span>
        </div>
      </div>

      <button id="exSubmit" class="btn-secondary" type="button">
        Exchange qilish (demo)
      </button>
    </div>
  </section>

  <!-- CRYPTO SCREEN -->
  <section id="screen-crypto" class="screen">
    <header class="sub-top-bar">
      <div class="sub-left">
        <button class="back-btn" type="button" onclick="openScreen('main')">‚Äπ</button>
        <div>
          <div class="sub-title-main">Crypto (demo)</div>
          <div class="sub-title-sub">USZ ‚Üí BTC / USDT ‚Äúfake‚Äù kalkulyator</div>
        </div>
      </div>
      <div class="balance-pill">
        <span>Fiat balans:</span>
        <span id="cryptoFiatBalance">9 200,00 USZ</span>
      </div>
    </header>

    <div class="card">
      <div class="card-title">Crypto sotib olish (demo)</div>

      <div class="form-group">
        <label class="form-label">Token</label>
        <select id="cryptoToken" class="select">
          <option value="BTC">BTC</option>
          <option value="USDT">USDT</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Fiat miqdor (USZ)</label>
        <input
          id="cryptoAmount"
          class="input"
          type="number"
          min="0"
          step="0.01"
          placeholder="Masalan: 1000"
        />
      </div>

      <div class="result-box">
        <div class="result-line">
          <span>Taxminiy kurs (demo)</span>
          <span id="cryptoRateLabel">1 BTC ‚âà 80 000 USZ</span>
        </div>
        <div class="result-line">
          <span>Qabul qilinadigan token</span>
          <span id="cryptoResult">0.0000 BTC</span>
        </div>
      </div>

      <button id="cryptoSubmit" class="btn-secondary" type="button">
        Hisoblash (demo)
      </button>
    </div>
  </section>

  <!-- STOCKS SCREEN -->
  <section id="screen-stocks" class="screen">
    <header class="sub-top-bar">
      <div class="sub-left">
        <button class="back-btn" type="button" onclick="openScreen('main')">‚Äπ</button>
        <div>
          <div class="sub-title-main">Stocks (demo)</div>
          <div class="sub-title-sub">
            US / KZ bozorlar bo‚Äòyicha virtual portfel
          </div>
        </div>
      </div>
      <div class="balance-pill">
        <span>Stocks demo:</span>
        <span id="stocksDemoBalance">1 099,55 USZ</span>
      </div>
    </header>

    <div class="card">
      <div class="card-title">Demo investitsiya</div>

      <div class="form-group">
        <label class="form-label">Instrument</label>
        <select id="stocksInstrument" class="select">
          <option value="AAPL">AAPL (US)</option>
          <option value="TSLA">TSLA (US)</option>
          <option value="KZTK">KZTK (KZ)</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Miqdor (USZ)</label>
        <input
          id="stocksAmount"
          class="input"
          type="number"
          min="0"
          step="0.01"
          placeholder="Masalan: 500"
        />
      </div>

      <div class="result-box">
        <div class="result-line">
          <span>Taxminiy lotlar soni (demo)</span>
          <span id="stocksLots">0.00</span>
        </div>
      </div>

      <button id="stocksSubmit" class="btn-secondary" type="button">
        Hisoblash (demo)
      </button>
    </div>
  </section>
<script>
    // --------- NAVIGATION (main / send / exchange / crypto / stocks) ---------
    function openScreen(name) {
      const base = window.location.origin + window.location.pathname;
      if (name === "main") {
        window.location.href = base;
      } else {
        window.location.href = base + "?screen=" + encodeURIComponent(name);
      }
    }

    function setActiveScreen(name) {
      const ids = ["main", "send", "exchange", "crypto", "stocks"];
      ids.forEach((id) => {
        const el = document.getElementById("screen-" + id);
        if (el) el.classList.toggle("active", id === name);
      });
    }

    // --------- DEMO DATA ----------
    const DEMO_BALANCES = {
      fiat: 9200.0,
      crypto: 2150.45,
      stocks: 1099.55,
    };
    const DEMO_RATE_UZS_KZT = 0.043608110119948886; // 1 UZS ‚âà 0.0436 KZT

    const fmt2 = new Intl.NumberFormat("ru-RU", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    });

    function formatUSZ(x) {
      return fmt2.format(x) + " USZ";
    }

    function formatKZT(x) {
      return fmt2.format(x) + " KZT";
    }

    // --------- INIT MAIN UI ----------
    function initSuperBalance() {
      const total =
        DEMO_BALANCES.fiat + DEMO_BALANCES.crypto + DEMO_BALANCES.stocks;

      const superEl = document.getElementById("superAmount");
      const assetFiat = document.getElementById("assetFiat");
      const assetCrypto = document.getElementById("assetCrypto");
      const assetStocks = document.getElementById("assetStocks");

      if (superEl) superEl.textContent = fmt2.format(total);
      if (assetFiat) assetFiat.textContent = formatUSZ(DEMO_BALANCES.fiat);
      if (assetCrypto) assetCrypto.textContent = formatUSZ(DEMO_BALANCES.crypto);
      if (assetStocks) assetStocks.textContent = formatUSZ(DEMO_BALANCES.stocks);

      const sendSB = document.getElementById("sendSuperBalance");
      const exSB = document.getElementById("exSuperBalance");
      if (sendSB) sendSB.textContent = formatUSZ(total);
      if (exSB) exSB.textContent = formatUSZ(total);

      const cryptoFiat = document.getElementById("cryptoFiatBalance");
      if (cryptoFiat) cryptoFiat.textContent = formatUSZ(DEMO_BALANCES.fiat);

      const stocksDemo = document.getElementById("stocksDemoBalance");
      if (stocksDemo)
        stocksDemo.textContent = formatUSZ(DEMO_BALANCES.stocks);
    }

    function initAssetsToggle() {
      const btn = document.getElementById("assetsToggle");
      const panel = document.getElementById("assetDetails");
      const label = document.getElementById("assetsToggleLabel");
      const chev = document.getElementById("assetsToggleChevron");
      if (!btn || !panel) return;

      let open = false;
      const sync = () => {
        panel.style.display = open ? "block" : "none";
        if (label) label.textContent = open ? "Yopish" : "Barcha aktivlar";
        if (chev) chev.textContent = open ? "‚ñ≤" : "‚ñº";
      };
      btn.addEventListener("click", () => {
        open = !open;
        sync();
      });
      sync();
    }

    // --------- PROFILE SHEET (simple) ----------
    function initProfileSheet() {
      const openBtn = document.getElementById("profileOpen");
      const closeBtn = document.getElementById("profileClose");
      const backdrop = document.getElementById("sheetBackdrop");

      const show = () => backdrop && backdrop.classList.add("visible");
      const hide = () => backdrop && backdrop.classList.remove("visible");

      if (openBtn && backdrop) {
        openBtn.addEventListener("click", show);
      }
      if (closeBtn && backdrop) {
        closeBtn.addEventListener("click", hide);
      }

      // Telegram WebApp user info (best effort)
      try {
        if (window.Telegram && Telegram.WebApp) {
          Telegram.WebApp.ready();
          const u = Telegram.WebApp.initDataUnsafe.user;
          if (u) {
            const fullName = [u.first_name, u.last_name].filter(Boolean).join(" ");
            const shortName =
              fullName || (u.username ? "@" + u.username : "Telegram user");
            const avatarInitial = (fullName || u.username || "TG")
              .trim()
              .charAt(0)
              .toUpperCase();

            const pfName = document.getElementById("pfName");
            const pfId = document.getElementById("pfId");
            const pfUsername = document.getElementById("pfUsername");
            const pAvatar = document.getElementById("profileAvatar");
            const pNameShort = document.getElementById("profileNameShort");

            if (pfName) pfName.textContent = fullName || "-";
            if (pfId) pfId.textContent = u.id ? String(u.id) : "-";
            if (pfUsername)
              pfUsername.textContent = u.username ? "@" + u.username : "-";
            if (pAvatar) pAvatar.textContent = avatarInitial;
            if (pNameShort) pNameShort.textContent = shortName;
          }
        }
      } catch (e) {
        // Agar WebApp bo‚Äòlmasa jim turamiz
        console.warn("Telegram WebApp init error:", e);
      }
    }

    // --------- SEND CALC ----------
    function recalcSend() {
      const amountEl = document.getElementById("sendAmount");
      const toCurEl = document.getElementById("sendToCurrency");
      if (!amountEl || !toCurEl) return;

      const raw = parseFloat(amountEl.value.replace(",", "."));
      const amount = isNaN(raw) ? 0 : raw;

      const rate =
        toCurEl.value === "KGS"
          ? DEMO_RATE_UZS_KZT * 0.5
          : DEMO_RATE_UZS_KZT; // shunchaki demo

      const gross = amount * rate;
      const feeEx = gross * 0.01;
      const feeTr = gross * 0.01;
      const feeTotal = feeEx + feeTr;
      const net = Math.max(gross - feeTotal, 0);

      document.getElementById("sendReceiverGets").textContent = formatKZT(net);
      document.getElementById("sendFeeExchange").textContent = formatKZT(feeEx);
      document.getElementById("sendFeeTransfer").textContent = formatKZT(feeTr);
      document.getElementById("sendFeeTotal").textContent = formatKZT(feeTotal);
    }

    function initSend() {
      const amountEl = document.getElementById("sendAmount");
      const toCurEl = document.getElementById("sendToCurrency");
      if (amountEl) amountEl.addEventListener("input", recalcSend);
      if (toCurEl) toCurEl.addEventListener("change", recalcSend);

      const btn = document.getElementById("sendSubmit");
      if (btn) {
        btn.addEventListener("click", () => {
          recalcSend();
          alert("Demo: transfer hisoblandi, lekin real yuborilmadi üôÇ");
        });
      }
    }

    // --------- EXCHANGE CALC ----------
    function recalcExchange() {
      const amountEl = document.getElementById("exAmount");
      if (!amountEl) return;
      const raw = parseFloat(amountEl.value.replace(",", "."));
      const amount = isNaN(raw) ? 0 : raw;

      const rate = DEMO_RATE_UZS_KZT; // demo
      const gross = amount * rate;
      const fee = gross * 0.01;
      const net = Math.max(gross - fee, 0);

      document.getElementById("exFee").textContent = formatKZT(fee);
      document.getElementById("exResult").textContent = formatKZT(net);
    }

    function initExchange() {
      const amountEl = document.getElementById("exAmount");
      if (amountEl) amountEl.addEventListener("input", recalcExchange);

      const btn = document.getElementById("exSubmit");
      if (btn) {
        btn.addEventListener("click", () => {
          recalcExchange();
          alert("Demo: exchange hisoblandi, real balans o‚Äòzgarmaydi üôÇ");
        });
      }
    }

    // --------- CRYPTO CALC ----------
    function recalcCrypto() {
      const tokenEl = document.getElementById("cryptoToken");
      const amountEl = document.getElementById("cryptoAmount");
      if (!tokenEl || !amountEl) return;

      const token = tokenEl.value;
      const raw = parseFloat(amountEl.value.replace(",", "."));
      const amount = isNaN(raw) ? 0 : raw;

      let price;
      if (token === "USDT") {
        price = 10_000; // 1 USDT ‚âà 10 000 USZ demo
      } else {
        price = 80_000; // 1 BTC ‚âà 80 000 USZ demo
      }

      const tokens = price > 0 ? amount / price : 0;

      const rateLabel =
        token === "USDT"
          ? "1 USDT ‚âà 10 000 USZ"
          : "1 BTC ‚âà 80 000 USZ";

      document.getElementById("cryptoRateLabel").textContent = rateLabel;
      document.getElementById("cryptoResult").textContent =
        tokens.toFixed(4) + " " + token;
    }

    function initCrypto() {
      const tokenEl = document.getElementById("cryptoToken");
      const amountEl = document.getElementById("cryptoAmount");

      if (tokenEl) tokenEl.addEventListener("change", recalcCrypto);
      if (amountEl) amountEl.addEventListener("input", recalcCrypto);

      const btn = document.getElementById("cryptoSubmit");
      if (btn) {
        btn.addEventListener("click", () => {
          recalcCrypto();
          alert("Demo: crypto miqdori hisoblandi, real savdo yo‚Äòq üôÇ");
        });
      }
    }

    // --------- STOCKS CALC ----------
    const STOCK_PRICES = {
      AAPL: 250, // demo USZ
      TSLA: 300,
      KZTK: 150,
    };

    function recalcStocks() {
      const instEl = document.getElementById("stocksInstrument");
      const amountEl = document.getElementById("stocksAmount");
      if (!instEl || !amountEl) return;

      const inst = instEl.value;
      const raw = parseFloat(amountEl.value.replace(",", "."));
      const amount = isNaN(raw) ? 0 : raw;

      const price = STOCK_PRICES[inst] || 250;
      const lots = price > 0 ? amount / price : 0;

      document.getElementById("stocksLots").textContent = lots.toFixed(2);
    }

    function initStocks() {
      const instEl = document.getElementById("stocksInstrument");
      const amountEl = document.getElementById("stocksAmount");
      if (instEl) instEl.addEventListener("change", recalcStocks);
      if (amountEl) amountEl.addEventListener("input", recalcStocks);

      const btn = document.getElementById("stocksSubmit");
      if (btn) {
        btn.addEventListener("click", () => {
          recalcStocks();
          alert("Demo: investitsiya lotlari hisoblandi, real savdo yo‚Äòq üôÇ");
        });
      }
    }

    // --------- ON LOAD ----------
    document.addEventListener("DOMContentLoaded", () => {
      // Which screen to show from URL
      const params = new URLSearchParams(window.location.search);
      const scr =
        params.get("screen") || params.get("mode") || "main";
      const allowed = ["main", "send", "exchange", "crypto", "stocks"];
      setActiveScreen(allowed.includes(scr) ? scr : "main");

      initSuperBalance();
      initAssetsToggle();
      initProfileSheet();
      initSend();
      initExchange();
      initCrypto();
      initStocks();
    });
  </script>
</main>
</body>
</html>

